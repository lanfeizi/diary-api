<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>å¤šåº”ç”¨æ—¥è®°ç³»ç»Ÿ - äº‘ç«¯åŒæ­¥ç‰ˆ</title>
    
    <!-- PWAé…ç½® -->
    <meta name="theme-color" content="#3498db">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
        /* ==================== åŸºç¡€æ ·å¼ ==================== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 10px;
            -webkit-tap-highlight-color: transparent;
        }

        /* ==================== åº”ç”¨é€‰æ‹©ç•Œé¢ ==================== */
        .app-selector {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .app-selector.hidden {
            display: none;
        }

        .app-selector-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .app-selector-header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .app-selector-header p {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .app-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            width: 100%;
            max-width: 500px;
            margin-bottom: 30px;
        }

        .app-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 140px;
        }

        .app-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .app-card.active {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
        }

        .app-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }

        .app-name {
            font-size: 14px;
            font-weight: 600;
            color: white;
            margin-bottom: 5px;
        }

        .app-stats {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
        }

        /* ==================== ä¸»ç¨‹åºç•Œé¢ ==================== */
        .main-content {
            display: none;
        }

        .main-content.active {
            display: block;
        }

        /* ==================== æ‰‹æœºä¼˜åŒ–ç•Œé¢ ==================== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        h1 {
            color: #2c3e50;
            margin: 0;
            font-size: 1.5rem;
        }

        .main-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        @media (min-width: 768px) {
            .main-container {
                flex-direction: row;
                height: calc(100vh - 80px);
            }
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* å·¦ä¾§é¢æ¿ - æ‰‹æœºæ—¶éšè—ï¼Œç”µè„‘æ—¶æ˜¾ç¤º */
        .left-panel {
            display: none;
        }

        @media (min-width: 768px) {
            .left-panel {
                display: block;
                width: 350px;
                min-width: 350px;
                overflow-y: auto;
            }
        }

        /* ==================== ç§»åŠ¨ç«¯ä¿®å¤ ==================== */
        
        /* ç§»åŠ¨ç«¯åº•éƒ¨å·¥å…·æ  */
        .mobile-toolbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #ddd;
            padding: 10px;
            display: flex;
            justify-content: space-around;
            z-index: 100;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        @media (min-width: 768px) {
            .mobile-toolbar {
                display: none;
            }
        }

        .mobile-tab {
            padding: 8px 12px;
            border: none;
            background: none;
            font-size: 12px;
            color: #666;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .mobile-tab.active {
            color: #3498db;
            font-weight: 600;
        }

        .mobile-tab-icon {
            font-size: 18px;
        }

        /* ç§»åŠ¨ç«¯å…¨å±é¢æ¿ - ä¿®å¤ç‰ˆ */
        .mobile-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 60px;
            background: white;
            z-index: 99;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            padding: 20px;
            padding-bottom: 100px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .mobile-panel.active {
            transform: translateX(0);
        }

        .mobile-panel-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
            z-index: 101;
            padding: 10px;
            -webkit-tap-highlight-color: transparent;
        }

        /* ç§»åŠ¨ç«¯è¾“å…¥æ¡†ä¿®å¤ - å…³é”®ä¿®å¤éƒ¨åˆ† */
        .mobile-panel textarea,
        .mobile-panel input,
        .mobile-panel select {
            font-size: 16px !important;
            -webkit-appearance: none;
            border-radius: 8px;
            border: 2px solid #ddd;
            padding: 12px;
            width: 100%;
            box-sizing: border-box;
            background: white;
            touch-action: pan-y pinch-zoom;
            -webkit-user-select: text;
            user-select: text;
        }

        .mobile-panel textarea {
            min-height: 250px;
            resize: vertical;
            line-height: 1.6;
            font-family: inherit;
            white-space: pre-wrap; /* ä¿ç•™ç©ºæ ¼å’Œæ¢è¡Œ */
            word-wrap: break-word;
        }

        .mobile-panel input:focus,
        .mobile-panel textarea:focus,
        .mobile-panel select:focus {
            outline: none;
            border-color: #3498db;
            position: relative;
            z-index: 1;
        }

        /* å¿«é€Ÿé€‰æ‹©æŒ‰é’®ä¿®å¤ */
        .mobile-panel .quick-select {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 12px 0;
        }

        .mobile-panel .quick-option {
            padding: 10px 16px;
            font-size: 14px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
            touch-action: manipulation;
            transition: all 0.2s ease;
        }

        .mobile-panel .quick-option:active {
            background: #e0e0e0;
            transform: scale(0.98);
        }

        /* åˆ†ç±»æŒ‰é’®ä¿®å¤ */
        .mobile-panel .category-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 8px;
            margin-bottom: 20px;
        }

        .mobile-panel .category-btn {
            padding: 12px 8px;
            font-size: 14px;
            background: #f0f0f0;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
            touch-action: manipulation;
            text-align: center;
        }

        .mobile-panel .category-btn:active {
            background: #e0e0e0;
        }

        .mobile-panel .category-btn.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
        }

        /* æŒ‰é’®ç»„ä¿®å¤ */
        .mobile-panel .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            margin-bottom: 40px;
        }

        .mobile-panel .btn-group button {
            flex: 1;
            padding: 14px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            -webkit-tap-highlight-color: rgba(0,0,0,0.1);
            touch-action: manipulation;
            transition: all 0.2s ease;
            font-weight: 600;
        }

        .mobile-panel .btn-group button:active {
            transform: scale(0.98);
            opacity: 0.9;
        }

        .mobile-panel .btn-group .btn-primary {
            background: #3498db;
            color: white;
        }

        .mobile-panel .btn-group .btn-secondary {
            background: #ecf0f1;
            color: #333;
        }

        /* é”®ç›˜å¼¹å‡ºæ—¶çš„ä¼˜åŒ– */
        @media screen and (max-height: 600px) {
            .mobile-panel {
                padding-bottom: 120px;
            }
            
            .mobile-panel textarea {
                min-height: 180px;
            }
        }

        /* å…¶ä»–æ ·å¼ä¿æŒä¸å˜ */
        h2 {
            color: #3498db;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            font-size: 1.3rem;
        }

        h3 {
            color: #555;
            margin: 12px 0 8px 0;
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }

        /* å±•ç¤ºåŒºåŸŸæ ·å¼ */
        .display-area {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
            margin-bottom: 15px;
        }

        .view-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .view-controls select {
            min-width: 120px;
        }

        .search-box {
            flex: 1;
            min-width: 150px;
            position: relative;
        }

        .search-box input {
            padding: 10px 35px 10px 12px;
            width: 100%;
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
        }

        .entry-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .entry-date {
            font-size: 12px;
            color: #666;
            font-weight: 600;
        }

        .entry-category {
            display: inline-block;
            padding: 3px 8px;
            background: #3498db;
            color: white;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .entry-content {
            color: #444;
            line-height: 1.6;
            white-space: pre-wrap; /* ä¿ç•™ç©ºæ ¼å’Œæ¢è¡Œ */
            word-wrap: break-word;
            margin: 8px 0;
            font-size: 14px;
        }

        .entry-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 8px;
        }

        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            color: white;
            font-weight: 500;
        }

        .tag-é‡è¦ { background: #e74c3c; }
        .tag-ç´§æ€¥ { background: #e67e22; }
        .tag-å·²å®Œæˆ { background: #2ecc71; }
        .tag-è¿›è¡Œä¸­ { background: #3498db; }
        .tag-çµæ„Ÿ { background: #9b59b6; }
        .tag-é—®é¢˜ { background: #34495e; }
        .tag-è§£å†³æ–¹æ¡ˆ { background: #1abc9c; }
        .tag-å¤ç›˜ { background: #f39c12; }
        .tag-æˆé•¿ { background: #27ae60; }
        .tag-çªç ´ { background: #8e44ad; }
        .tag-æ„Ÿè°¢ { background: #d35400; }
        .tag-è®¡åˆ’ { background: #2980b9; }
        .tag-default { background: #95a5a6; }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
        }

        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        button {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #ecf0f1;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d6dbdf;
        }

        .btn-success {
            background: #2ecc71;
            color: white;
        }

        .btn-success:hover {
            background: #27ae60;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #d68910;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .app-switcher {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 100;
            background: white;
            border: none;
            border-radius: 20px;
            padding: 8px 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .create-app-modal {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .icon-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .icon-option {
            font-size: 24px;
            padding: 15px;
            text-align: center;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .icon-option:hover {
            background: #e9ecef;
            transform: scale(1.1);
        }

        .icon-option.selected {
            background: #3498db;
            color: white;
        }

        .app-manager-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 999;
            padding: 20px;
            overflow-y: auto;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .app-manager-panel.active {
            transform: translateX(0);
        }

        .app-manager-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .app-manager-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        .app-manager-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .app-manager-icon {
            font-size: 24px;
        }

        .app-manager-meta {
            font-size: 12px;
            color: #666;
        }

        .app-manager-actions {
            display: flex;
            gap: 8px;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .page-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .page-btn:hover:not(:disabled) {
            background: #f0f0f0;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-info {
            font-size: 12px;
            color: #666;
        }

        .performance-warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .performance-warning.hidden {
            display: none;
        }

        .qr-container {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 15px 0;
        }

        #qrCanvas {
            display: block;
            margin: 0 auto;
            max-width: 100%;
            height: auto;
        }

        @media (max-width: 767px) {
            .app-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .app-card {
                padding: 15px;
                min-height: 120px;
            }
            
            .app-icon {
                font-size: 28px;
            }
            
            .app-name {
                font-size: 13px;
            }
            
            .icon-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .mobile-toolbar {
                padding-bottom: calc(10px + env(safe-area-inset-bottom));
            }
            
            .view-controls {
                flex-direction: column;
            }
            
            .view-controls select {
                width: 100%;
            }
        }

        @media print {
            .no-print, .mobile-toolbar, .app-switcher, .modal, button {
                display: none !important;
            }
            
            .main-content.active {
                display: block !important;
            }
            
            body {
                background: white !important;
                padding: 0 !important;
                font-size: 12pt !important;
            }
            
            .card {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
            }
            
            .entry-item {
                break-inside: avoid;
                page-break-inside: avoid;
                border: 1px solid #ddd !important;
            }
        }

        @keyframes slideIn {
            from { transform: translate(-50%, -20px); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translate(-50%, 0); opacity: 1; }
            to { transform: translate(-50%, -20px); opacity: 0; }
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #2ecc71;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 90%;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- ==================== åº”ç”¨é€‰æ‹©ç•Œé¢ ==================== -->
    <div id="appSelector" class="app-selector">
        <div class="app-selector-header">
            <h1>ğŸ“š æˆ‘çš„è®°å½•åº”ç”¨</h1>
            <p>é€‰æ‹©æˆ–åˆ›å»ºä¸€ä¸ªåº”ç”¨å¼€å§‹è®°å½•</p>
        </div>
        
        <div class="app-grid" id="appGrid">
            <!-- åº”ç”¨å¡ç‰‡å°†åŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <button class="btn-primary" onclick="showCreateAppModal()" style="max-width: 200px;">
            <span style="font-size: 18px;">â•</span> åˆ›å»ºæ–°åº”ç”¨
        </button>
    </div>

    <!-- ==================== åˆ›å»ºåº”ç”¨æ¨¡æ€æ¡† ==================== -->
    <div id="createAppModal" class="modal">
        <div class="modal-content create-app-modal">
            <h2>åˆ›å»ºæ–°åº”ç”¨</h2>
            
            <div class="form-group">
                <label>åº”ç”¨åç§°</label>
                <input type="text" id="newAppName" placeholder="ä¾‹å¦‚ï¼šè‹±è¯­å­¦ä¹ è®°å½•" maxlength="20">
            </div>
            
            <div class="form-group">
                <label>åº”ç”¨æè¿°ï¼ˆå¯é€‰ï¼‰</label>
                <input type="text" id="newAppDesc" placeholder="ç®€è¦æè¿°è¿™ä¸ªåº”ç”¨çš„ç”¨é€”">
            </div>
            
            <div class="form-group">
                <label>é€‰æ‹©å›¾æ ‡</label>
                <div class="icon-grid" id="iconGrid">
                    <!-- å›¾æ ‡å°†åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeCreateAppModal()">å–æ¶ˆ</button>
                <button class="btn-primary" onclick="createNewApp()">åˆ›å»ºåº”ç”¨</button>
            </div>
        </div>
    </div>

    <!-- ==================== åº”ç”¨ç®¡ç†é¢æ¿ ==================== -->
    <div id="appManagerPanel" class="app-manager-panel">
        <div class="app-manager-header">
            <h2>åº”ç”¨ç®¡ç†</h2>
            <button class="btn-secondary" onclick="hideAppManager()">å®Œæˆ</button>
        </div>
        
        <div id="appManagerList">
            <!-- åº”ç”¨ç®¡ç†åˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <div style="margin-top: 20px;">
            <button class="btn-primary" onclick="showCreateAppModal()" style="width: 100%;">
                <span style="font-size: 18px;">â•</span> åˆ›å»ºæ–°åº”ç”¨
            </button>
        </div>
    </div>

    <!-- ==================== ä¸»ç¨‹åºç•Œé¢ ==================== -->
    <div id="mainContent" class="main-content">
        <!-- åº”ç”¨åˆ‡æ¢æŒ‰é’® -->
        <button class="app-switcher" onclick="showAppManager()">
            <span id="currentAppIcon">ğŸ“</span>
            <span id="currentAppName" style="max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></span>
            <span>ğŸ”„</span>
        </button>

        <div class="header">
            <h1><span id="appIcon">ğŸ“</span> <span id="appTitleText">æ¯æ—¥æ€è€ƒè®°å½•</span></h1>
            <div class="tool-buttons no-print">
                <button class="btn-secondary" onclick="openStorageModal()">ğŸ’¾ å­˜å‚¨</button>
                <button class="btn-primary" onclick="openSyncModal()">ğŸ“¡ åŒæ­¥</button>
                <button class="btn-warning" onclick="openExportModal()">ğŸ“¤ å¯¼å‡º</button>
                <button class="btn-warning" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°</button>
            </div>
        </div>

        <div id="performanceWarning" class="performance-warning hidden">
            <span>âš ï¸ æ£€æµ‹åˆ°å¤§å®¹é‡æ•°æ®ï¼Œå»ºè®®å¼€å¯å‹ç¼©</span>
            <button onclick="openStorageModal()" style="padding: 4px 8px; font-size: 11px;">ä¼˜åŒ–å­˜å‚¨</button>
        </div>

        <div class="main-container">
            <!-- å·¦ä¾§é¢æ¿ï¼ˆç”µè„‘ç«¯æ˜¾ç¤ºï¼‰ -->
            <div class="left-panel card">
                <h2><span id="addRecordIcon">ğŸ“</span> æ–°å¢è®°å½•</h2>
                
                <div class="form-group">
                    <label>ç±»å‹</label>
                    <div class="category-container" id="categoryContainer">
                        <!-- åˆ†ç±»å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <div class="form-group">
                    <label>å†…å®¹</label>
                    <div class="quick-select" id="quickPhrases"></div>
                    <textarea id="content" placeholder="å†™ä¸‹ä½ çš„æ€è€ƒæˆ–æ´»åŠ¨å†…å®¹..."></textarea>
                </div>

                <div class="form-group">
                    <label>æ ‡ç­¾</label>
                    <div class="quick-select" id="quickTags"></div>
                    <input type="text" id="tags" placeholder="æ·»åŠ æ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”">
                </div>

                <div class="btn-group">
                    <button class="btn-primary" onclick="saveEntry()">ğŸ’¾ ä¿å­˜è®°å½•</button>
                    <button class="btn-secondary" onclick="clearForm()">ğŸ—‘ï¸ æ¸…ç©º</button>
                </div>

                <div style="margin-top: 20px;">
                    <h3>ğŸ“Š ç»Ÿè®¡</h3>
                    <div class="stats" id="stats"></div>
                </div>

                <div style="margin-top: 20px;">
                    <h3>âš™ï¸ ç®¡ç†</h3>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <button class="btn-warning" onclick="managePhrases()">ç®¡ç†å¸¸ç”¨çŸ­è¯­</button>
                        <button class="btn-danger" onclick="clearAllData()">æ¸…ç©ºå½“å‰åº”ç”¨</button>
                        <button class="btn-secondary" onclick="showAppManager()">åˆ‡æ¢åº”ç”¨</button>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§é¢æ¿ -->
            <div class="right-panel card">
                <h2>ğŸ“‹ æ‰€æœ‰è®°å½• <span id="recordCount" style="font-size: 14px; color: #666;"></span></h2>
                
                <div class="view-controls">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="æœç´¢å†…å®¹æˆ–æ ‡ç­¾..." 
                               oninput="debouncedFilter()">
                        <span class="search-icon">ğŸ”</span>
                    </div>
                    
                    <select id="filterCategory" onchange="debouncedFilter()">
                        <option value="all">å…¨éƒ¨åˆ†ç±»</option>
                        <!-- åˆ†ç±»é€‰é¡¹å°†åŠ¨æ€ç”Ÿæˆ -->
                    </select>
                    
                    <select id="dateRange" onchange="debouncedFilter()">
                        <option value="all">å…¨éƒ¨æ—¶é—´</option>
                        <option value="today">ä»Šå¤©</option>
                        <option value="week">æœ¬å‘¨</option>
                        <option value="month">æœ¬æœˆ</option>
                        <option value="year">ä»Šå¹´</option>
                    </select>
                    
                    <select id="pageSize" onchange="changePageSize()" style="width: 80px;">
                        <option value="20">20æ¡/é¡µ</option>
                        <option value="50">50æ¡/é¡µ</option>
                        <option value="100">100æ¡/é¡µ</option>
                        <option value="200">200æ¡/é¡µ</option>
                    </select>
                </div>

                <div class="display-area" id="displayArea">
                    <!-- è®°å½•å°†åŠ¨æ€æ˜¾ç¤º -->
                </div>

                <div class="pagination" id="pagination" style="display: none;">
                    <button class="page-btn" onclick="changePage(-1)" id="prevPage">ä¸Šä¸€é¡µ</button>
                    <span class="page-info" id="pageInfo">ç¬¬1é¡µ/å…±1é¡µ</span>
                    <button class="page-btn" onclick="changePage(1)" id="nextPage">ä¸‹ä¸€é¡µ</button>
                </div>
            </div>
        </div>

        <!-- ==================== ç§»åŠ¨ç«¯é¢æ¿ ==================== -->
        <div id="mobileAddPanel" class="mobile-panel">
            <button class="mobile-panel-close" onclick="closeMobilePanel('add')">âœ•</button>
            <h2><span id="mobileAppIcon">ğŸ“</span> æ–°å¢è®°å½•</h2>
            
            <div class="form-group">
                <label>ç±»å‹</label>
                <div class="category-container" id="mobileCategoryContainer">
                    <!-- ç§»åŠ¨ç«¯åˆ†ç±» -->
                </div>
            </div>

            <div class="form-group">
                <label>å†…å®¹</label>
                <div class="quick-select" id="mobileQuickPhrases"></div>
                <textarea id="mobileContent" placeholder="å†™ä¸‹ä½ çš„æ€è€ƒæˆ–æ´»åŠ¨å†…å®¹..."></textarea>
            </div>

            <div class="form-group">
                <label>æ ‡ç­¾</label>
                <div class="quick-select" id="mobileQuickTags"></div>
                <input type="text" id="mobileTags" placeholder="æ·»åŠ æ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”">
            </div>

            <div class="btn-group">
                <button class="btn-primary" onclick="saveMobileEntry()">ğŸ’¾ ä¿å­˜è®°å½•</button>
                <button class="btn-secondary" onclick="clearMobileForm()">ğŸ—‘ï¸ æ¸…ç©º</button>
            </div>
        </div>

        <div id="mobileStatsPanel" class="mobile-panel">
            <button class="mobile-panel-close" onclick="closeMobilePanel('stats')">âœ•</button>
            <h2>ğŸ“Š ç»Ÿè®¡ä¸ç®¡ç†</h2>
            <div class="stats" id="mobileStats"></div>
            
            <h3 style="margin-top: 20px;">âš™ï¸ åº”ç”¨ç®¡ç†</h3>
            <div style="display: flex; flex-direction: column; gap: 8px;">
                <button class="btn-warning" onclick="managePhrases()">ç®¡ç†å¸¸ç”¨çŸ­è¯­</button>
                <button class="btn-danger" onclick="clearAllData()">æ¸…ç©ºå½“å‰åº”ç”¨</button>
                <button class="btn-secondary" onclick="showAppManager()">åˆ‡æ¢åº”ç”¨</button>
                <button class="btn-secondary" onclick="backupData()">å¤‡ä»½æ•°æ®</button>
            </div>
        </div>

        <div class="mobile-toolbar">
            <button class="mobile-tab active" onclick="showMobilePanel('none')">
                <span class="mobile-tab-icon">ğŸ“‹</span>
                <span>è®°å½•</span>
            </button>
            <button class="mobile-tab" onclick="showMobilePanel('add')">
                <span class="mobile-tab-icon">â•</span>
                <span>æ–°å¢</span>
            </button>
            <button class="mobile-tab" onclick="showMobilePanel('stats')">
                <span class="mobile-tab-icon">ğŸ“Š</span>
                <span>ç»Ÿè®¡</span>
            </button>
            <button class="mobile-tab" onclick="openSyncModal()">
                <span class="mobile-tab-icon">ğŸ“¡</span>
                <span>åŒæ­¥</span>
            </button>
            <button class="mobile-tab" onclick="openExportModal()">
                <span class="mobile-tab-icon">ğŸ“¤</span>
                <span>å¯¼å‡º</span>
            </button>
        </div>

        <!-- ==================== æ¨¡æ€æ¡†ç³»ç»Ÿ ==================== -->
        
        <!-- å­˜å‚¨ç®¡ç†æ¨¡æ€æ¡† -->
        <div id="storageModal" class="modal">
            <div class="modal-content">
                <h2>ğŸ’¾ å­˜å‚¨ç®¡ç†</h2>
                <div class="form-group">
                    <div id="storageStats" style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 14px;"></div>
                </div>
                <div class="form-group">
                    <label>æ•°æ®å‹ç¼©</label>
                    <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 8px;">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="compressContent" checked> å¼€å¯å†…å®¹å‹ç¼©
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="optimizeDates"> ä¼˜åŒ–æ—¥æœŸæ ¼å¼
                        </label>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button class="btn-secondary" onclick="closeModal('storageModal')">å–æ¶ˆ</button>
                    <button class="btn-success" onclick="optimizeStorage()">ä¼˜åŒ–å­˜å‚¨</button>
                    <button class="btn-danger" onclick="clearOldData()">æ¸…ç†æ—§æ•°æ®</button>
                </div>
            </div>
        </div>

        <!-- åŒæ­¥æ¨¡æ€æ¡† - äº‘ç«¯ç‰ˆ -->
        <div id="syncModal" class="modal">
            <div class="modal-content">
                <h2>ğŸ“¡ æ•°æ®åŒæ­¥</h2>
                <div class="qr-container">
                    <canvas id="qrCanvas"></canvas>
                    <p style="margin-top: 10px; font-size: 13px; color: #666;">æ‰«æäºŒç»´ç è·å–å½“å‰æ•°æ®</p>
                </div>
                <div class="form-group">
                    <label>å¯¼å…¥æ•°æ® (JSONæ ¼å¼)</label>
                    <textarea id="importData" placeholder="ç²˜è´´è¦å¯¼å…¥çš„JSONæ•°æ®..." rows="4"></textarea>
                </div>
                <div class="modal-buttons">
                    <button class="btn-secondary" onclick="closeModal('syncModal')">å–æ¶ˆ</button>
                    <button class="btn-success" onclick="importData()">å¯¼å…¥æœ¬åœ°JSON</button>
                    <button class="btn-primary" onclick="exportJSON()">å¯¼å‡ºæœ¬åœ°JSON</button>
                </div>
                <hr>
                <h3>â˜ï¸ äº‘ç«¯åŒæ­¥</h3>
                <div style="margin-top: 10px;">
                    <div class="form-group">
                        <label>Cloudflare Workeråœ°å€</label>
                        <input type="text" id="cloudflareApiUrl" placeholder="diary-api.lanfeizi.workers.dev" value="https://diary-api.lanfeizi.workers.dev">
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                        <button class="btn-primary" onclick="pushToCloud()" style="flex:1">ä¸Šä¼ åˆ°äº‘ç«¯</button>
                        <button class="btn-primary" onclick="pullFromCloud()" style="flex:1">ä»äº‘ç«¯ä¸‹è½½</button>
                        <button class="btn-warning" onclick="syncWithCloud()" style="flex:1">åŒå‘åŒæ­¥</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¯¼å‡ºæ¨¡æ€æ¡† -->
        <div id="exportModal" class="modal">
            <div class="modal-content">
                <h2>ğŸ“¤ å¯¼å‡ºè®°å½•</h2>
                <div class="form-group">
                    <label>å¯¼å‡ºèŒƒå›´</label>
                    <select id="exportRange">
                        <option value="all">å…¨éƒ¨è®°å½•</option>
                        <option value="today">ä»Šæ—¥è®°å½•</option>
                        <option value="week">æœ¬å‘¨è®°å½•</option>
                        <option value="month">æœ¬æœˆè®°å½•</option>
                        <option value="search">å½“å‰æœç´¢ç»“æœ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å¯¼å‡ºæ ¼å¼</label>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">
                        <button class="btn-primary" onclick="exportToPDF()" style="flex-direction: column; height: 80px;">
                            <span style="font-size: 20px;">ğŸ“„</span>
                            <span>PDFæ–‡æ¡£</span>
                        </button>
                        <button class="btn-primary" onclick="exportToWord()" style="flex-direction: column; height: 80px;">
                            <span style="font-size: 20px;">ğŸ“</span>
                            <span>Wordæ–‡æ¡£</span>
                        </button>
                        <button class="btn-secondary" onclick="exportToText()" style="flex-direction: column; height: 80px;">
                            <span style="font-size: 20px;">ğŸ“‹</span>
                            <span>çº¯æ–‡æœ¬</span>
                        </button>
                        <button class="btn-secondary" onclick="exportJSON()" style="flex-direction: column; height: 80px;">
                            <span style="font-size: 20px;">ğŸ”„</span>
                            <span>JSONæ•°æ®</span>
                        </button>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button class="btn-secondary" onclick="closeModal('exportModal')">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <!-- å¸¸ç”¨çŸ­è¯­ç®¡ç†æ¨¡æ€æ¡† -->
        <div id="phraseModal" class="modal">
            <div class="modal-content">
                <h2>ğŸ“ ç®¡ç†å¸¸ç”¨çŸ­è¯­</h2>
                <div id="phraseList" style="margin-bottom: 20px; max-height: 200px; overflow-y: auto;"></div>
                <div class="form-group">
                    <input type="text" id="newPhrase" placeholder="è¾“å…¥æ–°çŸ­è¯­" style="margin-bottom: 10px;">
                    <button onclick="addCustomPhrase()" class="btn-primary">æ·»åŠ çŸ­è¯­</button>
                </div>
                <div class="modal-buttons">
                    <button class="btn-secondary" onclick="closeModal('phraseModal')">å…³é—­</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== äº‘ç«¯åŒæ­¥é…ç½® ====================
        // è¯·æ›¿æ¢ä¸ºæ‚¨çš„Cloudflare Workerå®é™…åœ°å€
        const DEFAULT_CLOUDFLARE_API_URL = 'diary-api.lanfeizi.workers.dev';
        
        // ==================== å¤šåº”ç”¨ç®¡ç†ç³»ç»Ÿ ====================
        
        // åº”ç”¨é…ç½®
        const AppSystem = {
            currentAppId: null,
            currentAppConfig: null,
            installedApps: {},
            
            // é»˜è®¤åº”ç”¨
            defaultApps: {
                'daily': {
                    id: 'daily',
                    name: 'æ¯æ—¥æ€è€ƒè®°å½•',
                    desc: 'è®°å½•æ—¥å¸¸æ€è€ƒä¸æ´»åŠ¨',
                    icon: 'ğŸ“',
                    categories: ['æ€è€ƒ', 'å·¥ä½œ', 'å­¦ä¹ ', 'ç”Ÿæ´»', 'å¥åº·'],
                    defaultTags: ['é‡è¦', 'ç´§æ€¥', 'å·²å®Œæˆ', 'è¿›è¡Œä¸­', 'çµæ„Ÿ', 'é—®é¢˜', 'è§£å†³æ–¹æ¡ˆ'],
                    storageKey: 'app_daily_data',
                    created: new Date().toISOString()
                },
                'life': {
                    id: 'life',
                    name: 'ç”Ÿæ´»è®°å½•',
                    desc: 'è®°å½•å®¶åº­ç”Ÿæ´»ä¸æ—¥å¸¸',
                    icon: 'ğŸ ',
                    categories: ['å®¶åº­', 'è´­ç‰©', 'å¥åº·', 'å¨±ä¹', 'ç¤¾äº¤'],
                    defaultTags: ['é‡è¦', 'è´­ç‰©æ¸…å•', 'å®¶åº­æ´»åŠ¨', 'å¥åº·ç®¡ç†', 'å¨±ä¹ä¼‘é—²'],
                    storageKey: 'app_life_data',
                    created: new Date().toISOString()
                },
                'english': {
                    id: 'english',
                    name: 'è‹±è¯­å­¦ä¹ ',
                    desc: 'è®°å½•è‹±è¯­å­¦ä¹ è¿›åº¦ä¸å¿ƒå¾—',
                    icon: 'ğŸ”¤',
                    categories: ['å•è¯', 'è¯­æ³•', 'é˜…è¯»', 'å¬åŠ›', 'å£è¯­', 'å†™ä½œ'],
                    defaultTags: ['æ–°å•è¯', 'è¯­æ³•éš¾ç‚¹', 'é˜…è¯»å¿ƒå¾—', 'å¬åŠ›ç»ƒä¹ ', 'å£è¯­çªç ´'],
                    storageKey: 'app_english_data',
                    created: new Date().toISOString()
                }
            },
            
            // å¯ç”¨å›¾æ ‡
            availableIcons: [
                'ğŸ“', 'ğŸ“š', 'ğŸ’¼', 'ğŸ ', 'ğŸƒ', 'â¤ï¸', 'ğŸ’°', 'ğŸ¯',
                'ğŸ”¤', 'ğŸ“–', 'ğŸµ', 'ğŸ¨', 'âœˆï¸', 'ğŸ³', 'ğŸ›’', 'ğŸ’¡',
                'ğŸ“', 'ğŸ’»', 'ğŸ“Š', 'ğŸ®', 'ğŸ‹ï¸', 'ğŸ', 'ğŸ“·', 'ğŸŒ±'
            ]
        };

        // å½“å‰åº”ç”¨çš„æ•°æ®
        const CurrentAppData = {
            entries: [],
            customPhrases: [],
            quickTags: [],
            categories: [],
            currentPage: 1,
            pageSize: 20,
            totalPages: 1,
            compressContent: true,
            debounceTimer: null
        };

        // æ ‡ç­¾é¢œè‰²æ˜ å°„
        const tagColors = {
            'é‡è¦': '#e74c3c',
            'ç´§æ€¥': '#e67e22',
            'å·²å®Œæˆ': '#2ecc71',
            'è¿›è¡Œä¸­': '#3498db',
            'çµæ„Ÿ': '#9b59b6',
            'é—®é¢˜': '#34495e',
            'è§£å†³æ–¹æ¡ˆ': '#1abc9c',
            'å¤ç›˜': '#f39c12',
            'æˆé•¿': '#27ae60',
            'çªç ´': '#8e44ad',
            'æ„Ÿè°¢': '#d35400',
            'è®¡åˆ’': '#2980b9'
        };

        // ==================== åº”ç”¨ç®¡ç†åŠŸèƒ½ ====================

        // åˆå§‹åŒ–åº”ç”¨ç³»ç»Ÿ
        function initAppSystem() {
            // åŠ è½½å·²å®‰è£…çš„åº”ç”¨
            loadInstalledApps();
            
            // æ£€æŸ¥URLå‚æ•°
            const urlParams = new URLSearchParams(window.location.search);
            const appId = urlParams.get('app');
            
            // æ£€æŸ¥ä¸Šæ¬¡ä½¿ç”¨çš„åº”ç”¨
            const lastUsedApp = localStorage.getItem('last_used_app');
            
            if (appId && AppSystem.installedApps[appId]) {
                // ç›´æ¥æ‰“å¼€URLæŒ‡å®šçš„åº”ç”¨
                selectApp(appId);
            } else if (lastUsedApp && AppSystem.installedApps[lastUsedApp]) {
                // æ‰“å¼€ä¸Šæ¬¡ä½¿ç”¨çš„åº”ç”¨
                selectApp(lastUsedApp);
            } else {
                // æ˜¾ç¤ºåº”ç”¨é€‰æ‹©ç•Œé¢
                showAppSelector();
            }
        }

        // åŠ è½½å·²å®‰è£…çš„åº”ç”¨
        function loadInstalledApps() {
            try {
                const installedAppsJson = localStorage.getItem('installed_apps');
                if (installedAppsJson) {
                    AppSystem.installedApps = JSON.parse(installedAppsJson);
                } else {
                    // åˆå§‹åŒ–é»˜è®¤åº”ç”¨
                    AppSystem.installedApps = JSON.parse(JSON.stringify(AppSystem.defaultApps));
                    saveInstalledApps();
                }
            } catch (error) {
                console.error('åŠ è½½åº”ç”¨åˆ—è¡¨å¤±è´¥:', error);
                AppSystem.installedApps = JSON.parse(JSON.stringify(AppSystem.defaultApps));
            }
            
            // æ›´æ–°åº”ç”¨åˆ—è¡¨æ˜¾ç¤º
            updateAppGrid();
        }

        // ä¿å­˜åº”ç”¨åˆ—è¡¨
        function saveInstalledApps() {
            localStorage.setItem('installed_apps', JSON.stringify(AppSystem.installedApps));
        }

        // é€‰æ‹©åº”ç”¨
        function selectApp(appId) {
            if (!AppSystem.installedApps[appId]) {
                console.error('åº”ç”¨ä¸å­˜åœ¨:', appId);
                showAppSelector();
                return;
            }
            
            // è®¾ç½®å½“å‰åº”ç”¨
            AppSystem.currentAppId = appId;
            AppSystem.currentAppConfig = AppSystem.installedApps[appId];
            
            // éšè—é€‰æ‹©ç•Œé¢ï¼Œæ˜¾ç¤ºä¸»ç¨‹åº
            document.getElementById('appSelector').classList.add('hidden');
            document.getElementById('mainContent').classList.add('active');
            
            // æ›´æ–°ç•Œé¢æ˜¾ç¤º
            updateAppDisplay();
            
            // åŠ è½½åº”ç”¨æ•°æ®
            loadAppData();
            
            // åˆå§‹åŒ–å½“å‰åº”ç”¨
            initCurrentApp();
            
            // ä¿å­˜æœ€åä½¿ç”¨çš„åº”ç”¨
            localStorage.setItem('last_used_app', appId);
            
            // æ›´æ–°URLï¼ˆå¯é€‰ï¼‰
            updateUrlWithAppId(appId);
        }

        // æ›´æ–°åº”ç”¨æ˜¾ç¤º
        function updateAppDisplay() {
            const config = AppSystem.currentAppConfig;
            
            // æ›´æ–°æ ‡é¢˜å’Œå›¾æ ‡
            const appTitleText = document.getElementById('appTitleText');
            const appIcon = document.getElementById('appIcon');
            const addRecordIcon = document.getElementById('addRecordIcon');
            const mobileAppIcon = document.getElementById('mobileAppIcon');
            const currentAppName = document.getElementById('currentAppName');
            const currentAppIcon = document.getElementById('currentAppIcon');
            
            if (appTitleText) appTitleText.textContent = config.name;
            if (appIcon) appIcon.textContent = config.icon;
            if (addRecordIcon) addRecordIcon.textContent = config.icon;
            if (mobileAppIcon) mobileAppIcon.textContent = config.icon;
            if (currentAppName) currentAppName.textContent = config.name;
            if (currentAppIcon) currentAppIcon.textContent = config.icon;
            
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = `${config.icon} ${config.name}`;
            
            // æ›´æ–°åº”ç”¨å¡ç‰‡æ¿€æ´»çŠ¶æ€
            updateAppGrid();
        }

        // æ˜¾ç¤ºåº”ç”¨é€‰æ‹©å™¨
        function showAppSelector() {
            AppSystem.currentAppId = null;
            AppSystem.currentAppConfig = null;
            
            document.getElementById('appSelector').classList.remove('hidden');
            document.getElementById('mainContent').classList.remove('active');
        }

        // æ›´æ–°åº”ç”¨ç½‘æ ¼æ˜¾ç¤º
        function updateAppGrid() {
            const appGrid = document.getElementById('appGrid');
            if (!appGrid) return;
            
            appGrid.innerHTML = '';
            
            Object.values(AppSystem.installedApps).forEach(app => {
                const isCurrent = app.id === AppSystem.currentAppId;
                
                // è·å–åº”ç”¨ç»Ÿè®¡æ•°æ®
                const stats = getAppStats(app.id);
                
                const appCard = document.createElement('div');
                appCard.className = `app-card ${isCurrent ? 'active' : ''}`;
                appCard.onclick = () => selectApp(app.id);
                appCard.innerHTML = `
                    <span class="app-icon">${app.icon}</span>
                    <div class="app-name">${app.name}</div>
                    ${app.desc ? `<div style="font-size: 11px; color: rgba(255,255,255,0.7); margin-top: 2px;">${app.desc}</div>` : ''}
                    ${stats.count > 0 ? `<div class="app-stats">${stats.count}æ¡è®°å½•</div>` : ''}
                `;
                
                appGrid.appendChild(appCard);
            });
        }

        // è·å–åº”ç”¨ç»Ÿè®¡æ•°æ®
        function getAppStats(appId) {
            try {
                const app = AppSystem.installedApps[appId];
                if (!app) return { count: 0 };
                
                // å°è¯•åŠ è½½æ•°æ®ç»Ÿè®¡
                const storageKey = app.storageKey;
                const compressedKey = `${storageKey}_compressed`;
                let entries = [];
                
                if (localStorage.getItem(compressedKey)) {
                    // æœ‰å‹ç¼©æ•°æ®
                    entries = decompressData(localStorage.getItem(compressedKey));
                } else if (localStorage.getItem(storageKey)) {
                    // æœ‰æ™®é€šæ•°æ®
                    entries = JSON.parse(localStorage.getItem(storageKey));
                }
                
                return {
                    count: entries.length,
                    lastUpdate: entries.length > 0 ? new Date(entries[0].timestamp) : null
                };
            } catch (error) {
                return { count: 0 };
            }
        }

        // æ˜¾ç¤ºåˆ›å»ºåº”ç”¨æ¨¡æ€æ¡†
        function showCreateAppModal() {
            // å¡«å……å›¾æ ‡ç½‘æ ¼
            const iconGrid = document.getElementById('iconGrid');
            iconGrid.innerHTML = '';
            
            AppSystem.availableIcons.forEach(icon => {
                const iconOption = document.createElement('div');
                iconOption.className = 'icon-option';
                iconOption.textContent = icon;
                iconOption.onclick = () => selectCreateIcon(icon);
                iconGrid.appendChild(iconOption);
            });
            
            // é‡ç½®è¡¨å•
            const newAppName = document.getElementById('newAppName');
            const newAppDesc = document.getElementById('newAppDesc');
            if (newAppName) newAppName.value = '';
            if (newAppDesc) newAppDesc.value = '';
            window.selectedCreateIcon = 'ğŸ“';
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            document.getElementById('createAppModal').style.display = 'flex';
        }

        // å…³é—­åˆ›å»ºåº”ç”¨æ¨¡æ€æ¡†
        function closeCreateAppModal() {
            document.getElementById('createAppModal').style.display = 'none';
        }

        // é€‰æ‹©åˆ›å»ºå›¾æ ‡
        function selectCreateIcon(icon) {
            window.selectedCreateIcon = icon;
            document.querySelectorAll('.icon-option').forEach(el => {
                el.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        // åˆ›å»ºæ–°åº”ç”¨
        function createNewApp() {
            const name = document.getElementById('newAppName').value.trim();
            const desc = document.getElementById('newAppDesc').value.trim();
            const icon = window.selectedCreateIcon || 'ğŸ“';
            
            if (!name) {
                alert('è¯·è¾“å…¥åº”ç”¨åç§°');
                return;
            }
            
            // ç”Ÿæˆåº”ç”¨ID
            const appId = generateAppId(name);
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            if (AppSystem.installedApps[appId]) {
                alert('åº”ç”¨åç§°å·²å­˜åœ¨ï¼Œè¯·ä½¿ç”¨å…¶ä»–åç§°');
                return;
            }
            
            // åˆ›å»ºæ–°åº”ç”¨é…ç½®
            const newApp = {
                id: appId,
                name: name,
                desc: desc,
                icon: icon,
                categories: ['é»˜è®¤åˆ†ç±»'],
                defaultTags: ['é‡è¦', 'ç¬”è®°', 'å¿ƒå¾—'],
                storageKey: `app_${appId}_data`,
                created: new Date().toISOString()
            };
            
            // æ·»åŠ åˆ°åº”ç”¨åˆ—è¡¨
            AppSystem.installedApps[appId] = newApp;
            saveInstalledApps();
            
            // å…³é—­æ¨¡æ€æ¡†
            closeCreateAppModal();
            
            // é€‰ä¸­æ–°åˆ›å»ºçš„åº”ç”¨
            selectApp(appId);
        }

        // ç”Ÿæˆåº”ç”¨ID
        function generateAppId(appName) {
            return appName.toLowerCase()
                .replace(/[^\w\s\u4e00-\u9fa5]/gi, '')
                .replace(/\s+/g, '_')
                .replace(/[^a-z0-9_\u4e00-\u9fa5]/g, '');
        }

        // æ˜¾ç¤ºåº”ç”¨ç®¡ç†é¢æ¿
        function showAppManager() {
            updateAppManagerList();
            document.getElementById('appManagerPanel').classList.add('active');
        }

        // éšè—åº”ç”¨ç®¡ç†é¢æ¿
        function hideAppManager() {
            document.getElementById('appManagerPanel').classList.remove('active');
        }

        // æ›´æ–°åº”ç”¨ç®¡ç†åˆ—è¡¨
        function updateAppManagerList() {
            const managerList = document.getElementById('appManagerList');
            if (!managerList) return;
            
            managerList.innerHTML = '';
            
            Object.values(AppSystem.installedApps).forEach(app => {
                const isCurrent = app.id === AppSystem.currentAppId;
                const stats = getAppStats(app.id);
                
                const appItem = document.createElement('div');
                appItem.className = 'app-manager-item';
                appItem.innerHTML = `
                    <div class="app-manager-info">
                        <span class="app-manager-icon">${app.icon}</span>
                        <div>
                            <div style="font-weight: 600;">${app.name}</div>
                            <div class="app-manager-meta">
                                ${app.desc ? app.desc + ' â€¢ ' : ''}
                                ${stats.count}æ¡è®°å½•
                                ${isCurrent ? 'â€¢ å½“å‰ä½¿ç”¨' : ''}
                            </div>
                        </div>
                    </div>
                    <div class="app-manager-actions">
                        ${!isCurrent ? `
                            <button class="btn-secondary" onclick="switchToApp('${app.id}')" style="padding: 6px 10px; font-size: 12px;">åˆ‡æ¢</button>
                            <button class="btn-danger" onclick="deleteApp('${app.id}')" style="padding: 6px 10px; font-size: 12px;">åˆ é™¤</button>
                        ` : `
                            <span style="font-size: 12px; color: #3498db; padding: 6px 10px;">å½“å‰ä½¿ç”¨</span>
                        `}
                    </div>
                `;
                
                managerList.appendChild(appItem);
            });
        }

        // åˆ‡æ¢åˆ°åº”ç”¨
        function switchToApp(appId) {
            selectApp(appId);
            hideAppManager();
        }

        // åˆ é™¤åº”ç”¨
        function deleteApp(appId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåº”ç”¨å—ï¼Ÿæ‰€æœ‰æ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤ï¼')) {
                return;
            }
            
            // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰åº”ç”¨ï¼Œå…ˆåˆ‡æ¢åˆ°å…¶ä»–åº”ç”¨
            if (appId === AppSystem.currentAppId) {
                const otherApp = Object.values(AppSystem.installedApps).find(app => app.id !== appId);
                if (otherApp) {
                    selectApp(otherApp.id);
                } else {
                    showAppSelector();
                }
            }
            
            // åˆ é™¤åº”ç”¨æ•°æ®
            const app = AppSystem.installedApps[appId];
            if (app) {
                localStorage.removeItem(app.storageKey);
                localStorage.removeItem(`${app.storageKey}_compressed`);
                localStorage.removeItem(`${app.storageKey}_config`);
                localStorage.removeItem(`${app.storageKey}_compress`);
            }
            
            // ä»åˆ—è¡¨ä¸­åˆ é™¤
            delete AppSystem.installedApps[appId];
            saveInstalledApps();
            
            // æ›´æ–°æ˜¾ç¤º
            updateAppManagerList();
            updateAppGrid();
        }

        // æ›´æ–°URLï¼ˆå¯é€‰ï¼‰
        function updateUrlWithAppId(appId) {
            if (history.pushState) {
                const newUrl = window.location.pathname + '?app=' + appId;
                history.pushState(null, '', newUrl);
            }
        }

        // ==================== å½“å‰åº”ç”¨çš„æ•°æ®ç®¡ç† ====================

        // åŠ è½½åº”ç”¨æ•°æ®
        function loadAppData() {
            const storageKey = AppSystem.currentAppConfig.storageKey;
            
            try {
                // å°è¯•åŠ è½½å‹ç¼©æ•°æ®
                const compressedKey = `${storageKey}_compressed`;
                const compressedData = localStorage.getItem(compressedKey);
                
                if (compressedData) {
                    CurrentAppData.entries = decompressData(compressedData);
                } else {
                    // å°è¯•æ™®é€šæ•°æ®
                    const dataJson = localStorage.getItem(storageKey);
                    CurrentAppData.entries = dataJson ? JSON.parse(dataJson) : [];
                }
                
                // åŠ è½½åº”ç”¨é…ç½®
                const configKey = `${storageKey}_config`;
                const configJson = localStorage.getItem(configKey);
                if (configJson) {
                    const config = JSON.parse(configJson);
                    CurrentAppData.customPhrases = config.customPhrases || [];
                    CurrentAppData.quickTags = config.quickTags || AppSystem.currentAppConfig.defaultTags;
                    CurrentAppData.categories = config.categories || AppSystem.currentAppConfig.categories;
                    CurrentAppData.compressContent = config.compressContent !== false;
                } else {
                    // ä½¿ç”¨é»˜è®¤é…ç½®
                    CurrentAppData.customPhrases = [];
                    CurrentAppData.quickTags = AppSystem.currentAppConfig.defaultTags;
                    CurrentAppData.categories = AppSystem.currentAppConfig.categories;
                    CurrentAppData.compressContent = true;
                }
                
            } catch (error) {
                console.error('åŠ è½½åº”ç”¨æ•°æ®å¤±è´¥:', error);
                CurrentAppData.entries = [];
                CurrentAppData.customPhrases = [];
                CurrentAppData.quickTags = AppSystem.currentAppConfig.defaultTags;
                CurrentAppData.categories = AppSystem.currentAppConfig.categories;
                CurrentAppData.compressContent = true;
            }
        }

        // ä¿å­˜åº”ç”¨æ•°æ®
        function saveAppData() {
            if (!AppSystem.currentAppId) return false;
            
            const storageKey = AppSystem.currentAppConfig.storageKey;
            
            try {
                // ä¿å­˜æ•°æ®
                if (CurrentAppData.compressContent) {
                    const compressed = compressData(CurrentAppData.entries);
                    localStorage.setItem(`${storageKey}_compressed`, compressed);
                    localStorage.removeItem(storageKey);
                } else {
                    localStorage.setItem(storageKey, JSON.stringify(CurrentAppData.entries));
                }
                
                // ä¿å­˜é…ç½®
                const config = {
                    customPhrases: CurrentAppData.customPhrases,
                    quickTags: CurrentAppData.quickTags,
                    categories: CurrentAppData.categories,
                    compressContent: CurrentAppData.compressContent,
                    updated: new Date().toISOString()
                };
                localStorage.setItem(`${storageKey}_config`, JSON.stringify(config));
                
                return true;
            } catch (error) {
                console.error('ä¿å­˜åº”ç”¨æ•°æ®å¤±è´¥:', error);
                return false;
            }
        }

        // ==================== å½“å‰åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ ====================

        // åˆå§‹åŒ–å½“å‰åº”ç”¨
        function initCurrentApp() {
            // æ›´æ–°åˆ†ç±»æ˜¾ç¤º
            updateCategoryDisplay();
            
            // æ›´æ–°å¸¸ç”¨çŸ­è¯­å’Œæ ‡ç­¾
            renderQuickSelect();
            renderMobileQuickSelect();
            
            // æ¸²æŸ“ç»Ÿè®¡å’Œè®°å½•
            renderStats();
            renderAllEntries();
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬
            setupEventListeners();
            
            // è®¾ç½®ç§»åŠ¨ç«¯è¾“å…¥å¤„ç†å™¨
            setupMobileInputHandlers();
            
            // æ£€æŸ¥å­˜å‚¨çŠ¶æ€
            checkStorageStatus();
            
            // åˆå§‹åŒ–é»˜è®¤å¸¸ç”¨çŸ­è¯­
            if (CurrentAppData.customPhrases.length === 0) {
                CurrentAppData.customPhrases = [
                    "ä»Šæ—¥å®Œæˆä¸»è¦å·¥ä½œ",
                    "é‡åˆ°é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ",
                    "æ˜æ—¥è®¡åˆ’å®‰æ’",
                    "é‡è¦ä¼šè®®è®°å½•",
                    "å­¦ä¹ æ”¶è·",
                    "åˆ›æ„çµæ„Ÿ",
                    "å€¼å¾—æ„Ÿæ©"
                ];
                saveAppData();
            }
            
            updateRecordCount();
        }

        // æ›´æ–°åˆ†ç±»æ˜¾ç¤º
        function updateCategoryDisplay() {
            const categories = CurrentAppData.categories;
            
            // æ›´æ–°ç”µè„‘ç«¯åˆ†ç±»
            const categoryContainer = document.getElementById('categoryContainer');
            if (categoryContainer) {
                categoryContainer.innerHTML = '';
                
                categories.forEach((category, index) => {
                    const btn = document.createElement('button');
                    btn.className = `category-btn ${index === 0 ? 'active' : ''}`;
                    btn.dataset.category = category;
                    btn.textContent = category;
                    btn.onclick = function() {
                        document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                    };
                    categoryContainer.appendChild(btn);
                });
            }
            
            // æ›´æ–°ç§»åŠ¨ç«¯åˆ†ç±»
            const mobileCategoryContainer = document.getElementById('mobileCategoryContainer');
            if (mobileCategoryContainer) {
                mobileCategoryContainer.innerHTML = '';
                
                categories.forEach((category, index) => {
                    const btn = document.createElement('button');
                    btn.className = `category-btn ${index === 0 ? 'active' : ''}`;
                    btn.dataset.category = category;
                    btn.textContent = category;
                    btn.onclick = function() {
                        document.querySelectorAll('#mobileCategoryContainer .category-btn').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                    };
                    mobileCategoryContainer.appendChild(btn);
                });
            }
            
            // æ›´æ–°ç­›é€‰ä¸‹æ‹‰æ¡†
            const filterCategory = document.getElementById('filterCategory');
            if (filterCategory) {
                filterCategory.innerHTML = '<option value="all">å…¨éƒ¨åˆ†ç±»</option>';
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    filterCategory.appendChild(option);
                });
            }
        }

        // æ¸²æŸ“å¿«é€Ÿé€‰æ‹©ï¼ˆç”µè„‘ç«¯ï¼‰
        function renderQuickSelect() {
            const quickPhrasesDiv = document.getElementById('quickPhrases');
            const quickTagsDiv = document.getElementById('quickTags');

            if (quickPhrasesDiv) quickPhrasesDiv.innerHTML = '';
            if (quickTagsDiv) quickTagsDiv.innerHTML = '';

            // æ˜¾ç¤ºå¸¸ç”¨çŸ­è¯­
            if (quickPhrasesDiv) {
                CurrentAppData.customPhrases.slice(0, 8).forEach(phrase => {
                    const btn = document.createElement('button');
                    btn.className = 'quick-option';
                    btn.textContent = phrase;
                    btn.onclick = () => {
                        const textarea = document.getElementById('content');
                        insertTextAtCursor(textarea, phrase);
                        textarea.focus();
                    };
                    quickPhrasesDiv.appendChild(btn);
                });
            }

            // æ˜¾ç¤ºå¸¸ç”¨æ ‡ç­¾ï¼ˆå¸¦é¢œè‰²ï¼‰
            if (quickTagsDiv) {
                CurrentAppData.quickTags.forEach(tag => {
                    const btn = document.createElement('button');
                    btn.className = 'quick-option';
                    btn.textContent = tag;
                    btn.style.backgroundColor = tagColors[tag] || '#95a5a6';
                    btn.style.color = 'white';
                    btn.style.border = 'none';
                    btn.onclick = () => {
                        const tagsInput = document.getElementById('tags');
                        addTagToInput(tagsInput, tag);
                    };
                    quickTagsDiv.appendChild(btn);
                });
            }
        }

        // æ¸²æŸ“ç§»åŠ¨ç«¯å¿«é€Ÿé€‰æ‹©
        function renderMobileQuickSelect() {
            const quickPhrasesDiv = document.getElementById('mobileQuickPhrases');
            const quickTagsDiv = document.getElementById('mobileQuickTags');

            if (quickPhrasesDiv) quickPhrasesDiv.innerHTML = '';
            if (quickTagsDiv) quickTagsDiv.innerHTML = '';

            // æ˜¾ç¤ºå¸¸ç”¨çŸ­è¯­
            if (quickPhrasesDiv) {
                CurrentAppData.customPhrases.slice(0, 6).forEach(phrase => {
                    const btn = document.createElement('button');
                    btn.className = 'quick-option';
                    btn.textContent = phrase;
                    btn.onclick = () => {
                        const textarea = document.getElementById('mobileContent');
                        insertTextAtCursor(textarea, phrase);
                        textarea.focus();
                    };
                    quickPhrasesDiv.appendChild(btn);
                });
            }

            // æ˜¾ç¤ºå¸¸ç”¨æ ‡ç­¾ï¼ˆå¸¦é¢œè‰²ï¼‰
            if (quickTagsDiv) {
                CurrentAppData.quickTags.slice(0, 8).forEach(tag => {
                    const btn = document.createElement('button');
                    btn.className = 'quick-option';
                    btn.textContent = tag;
                    btn.style.backgroundColor = tagColors[tag] || '#95a5a6';
                    btn.style.color = 'white';
                    btn.style.border = 'none';
                    btn.onclick = () => {
                        const tagsInput = document.getElementById('mobileTags');
                        addTagToInput(tagsInput, tag);
                    };
                    quickTagsDiv.appendChild(btn);
                });
            }
        }

        // åœ¨å…‰æ ‡ä½ç½®æ’å…¥æ–‡æœ¬
        function insertTextAtCursor(textarea, text) {
            if (!textarea) return;
            
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const currentText = textarea.value;
            
            let prefix = '';
            if (start > 0 && !currentText[start - 1].match(/[\n\r]/)) {
                prefix = '\n';
            }
            
            textarea.value = currentText.substring(0, start) + prefix + text + currentText.substring(end);
            textarea.selectionStart = textarea.selectionEnd = start + prefix.length + text.length;
        }

        // æ·»åŠ æ ‡ç­¾åˆ°è¾“å…¥æ¡†
        function addTagToInput(input, tag) {
            if (!input) return;
            
            const currentTags = input.value ? 
                input.value.split(',').map(t => t.trim()).filter(t => t) : [];
            
            if (!currentTags.includes(tag)) {
                currentTags.push(tag);
                input.value = currentTags.join(', ');
            }
            
            input.focus();
        }

        // ä¿®å¤ç§»åŠ¨ç«¯è¾“å…¥å¤„ç†å™¨
        function setupMobileInputHandlers() {
            const mobileTextarea = document.getElementById('mobileContent');
            if (mobileTextarea) {
                // ç›‘å¬ç²˜è´´äº‹ä»¶ï¼Œä¿ç•™åŸå§‹æ ¼å¼
                mobileTextarea.addEventListener('paste', function(e) {
                    e.preventDefault();
                    
                    // è·å–ç²˜è´´çš„æ–‡æœ¬
                    let pastedText = (e.clipboardData || window.clipboardData).getData('text');
                    
                    // ä¿ç•™åŸå§‹æ ¼å¼ï¼ŒåŒ…æ‹¬æ¢è¡Œå’Œç©ºæ ¼
                    const start = this.selectionStart;
                    const end = this.selectionEnd;
                    const currentValue = this.value;
                    
                    // åœ¨å…‰æ ‡ä½ç½®æ’å…¥ç²˜è´´çš„æ–‡æœ¬
                    const newValue = currentValue.substring(0, start) + pastedText + currentValue.substring(end);
                    this.value = newValue;
                    
                    // å°†å…‰æ ‡ç§»åŠ¨åˆ°ç²˜è´´æ–‡æœ¬çš„æœ«å°¾
                    this.selectionStart = this.selectionEnd = start + pastedText.length;
                    
                    // è§¦å‘inputäº‹ä»¶
                    this.dispatchEvent(new Event('input', { bubbles: true }));
                });
                
                // ä¿®å¤è¾“å…¥æ¡†æ»šåŠ¨é—®é¢˜
                mobileTextarea.addEventListener('touchstart', function(e) {
                    e.stopPropagation();
                });
                
                // ç¡®ä¿è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹æ—¶ä¸ç§»åŠ¨
                mobileTextarea.addEventListener('focus', function() {
                    setTimeout(() => {
                        this.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                });
            }
        }

        // ==================== äº‘ç«¯åŒæ­¥åŠŸèƒ½ ====================

        // è·å–Cloudflare APIåœ°å€
        function getCloudflareApiUrl() {
            const input = document.getElementById('cloudflareApiUrl');
            return input ? input.value.trim() || DEFAULT_CLOUDFLARE_API_URL : DEFAULT_CLOUDFLARE_API_URL;
        }

        // ä¸Šä¼ åˆ°äº‘ç«¯
        async function pushToCloud() {
            if (!AppSystem.currentAppId) {
                showNotification('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªåº”ç”¨');
                return;
            }
            
            const entries = CurrentAppData.entries;
            if (entries.length === 0) {
                showNotification('æ²¡æœ‰æ•°æ®å¯ä¸Šä¼ ');
                return;
            }

            const apiUrl = getCloudflareApiUrl();
            showNotification('æ­£åœ¨ä¸Šä¼ åˆ°äº‘ç«¯...');

            try {
                const response = await fetch(`${apiUrl}/api/entries`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(entries.map(e => ({
                        id: e.id,
                        appId: AppSystem.currentAppId,
                        content: e.content,
                        category: e.category || '',
                        tags: e.tags || [],
                        date: e.date,
                        dateISO: e.dateISO,
                        timestamp: e.timestamp
                    })))
                });
                
                if (response.ok) {
                    showNotification(`æˆåŠŸä¸Šä¼  ${entries.length} æ¡è®°å½•åˆ°äº‘ç«¯`);
                } else {
                    const error = await response.text();
                    throw new Error(error || 'ä¸Šä¼ å¤±è´¥');
                }
            } catch (err) {
                console.error('ä¸Šä¼ å¤±è´¥:', err);
                showNotification('äº‘ç«¯è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åœ°å€å’Œç½‘ç»œ');
            }
        }

        // ä»äº‘ç«¯ä¸‹è½½
        async function pullFromCloud() {
            if (!AppSystem.currentAppId) {
                showNotification('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªåº”ç”¨');
                return;
            }

            const apiUrl = getCloudflareApiUrl();
            showNotification('æ­£åœ¨ä»äº‘ç«¯ä¸‹è½½...');

            try {
                const response = await fetch(`${apiUrl}/api/entries?appId=${AppSystem.currentAppId}`);
                if (!response.ok) throw new Error('ä¸‹è½½å¤±è´¥');
                
                const cloudEntries = await response.json();
                if (!Array.isArray(cloudEntries)) throw new Error('æ•°æ®æ ¼å¼é”™è¯¯');

                // è½¬æ¢äº‘ç«¯æ•°æ®æ ¼å¼
                const convertedEntries = cloudEntries.map(e => ({
                    id: e.uuid || e.id,
                    date: e.date,
                    dateISO: e.date_iso || e.dateISO,
                    category: e.category,
                    content: e.content,
                    tags: typeof e.tags === 'string' ? JSON.parse(e.tags) : (e.tags || []),
                    timestamp: e.timestamp
                }));

                if (convertedEntries.length === 0) {
                    showNotification('äº‘ç«¯æ²¡æœ‰è®°å½•');
                    return;
                }

                // åˆå¹¶åˆ°æœ¬åœ°ï¼ˆæŒ‰IDå»é‡ï¼‰
                const localIds = new Set(CurrentAppData.entries.map(e => e.id));
                const newEntries = convertedEntries.filter(e => !localIds.has(e.id));
                
                if (newEntries.length > 0) {
                    CurrentAppData.entries = [...CurrentAppData.entries, ...newEntries];
                    CurrentAppData.entries.sort((a, b) => b.timestamp - a.timestamp);
                    saveAppData();
                    renderAllEntries();
                    renderStats();
                    showNotification(`ä»äº‘ç«¯ä¸‹è½½ ${newEntries.length} æ¡æ–°è®°å½•`);
                } else {
                    showNotification('äº‘ç«¯æ²¡æœ‰æ–°è®°å½•');
                }
            } catch (err) {
                console.error('ä¸‹è½½å¤±è´¥:', err);
                showNotification('äº‘ç«¯è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åœ°å€å’Œç½‘ç»œ');
            }
        }

        // åŒå‘åŒæ­¥ï¼ˆåˆå¹¶äº‘ç«¯å’Œæœ¬åœ°ï¼‰
        async function syncWithCloud() {
            if (!AppSystem.currentAppId) {
                showNotification('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªåº”ç”¨');
                return;
            }

            const apiUrl = getCloudflareApiUrl();
            showNotification('æ­£åœ¨åŒæ­¥äº‘ç«¯æ•°æ®...');

            try {
                // å…ˆä¸Šä¼ æœ¬åœ°æ‰€æœ‰æ•°æ®
                await fetch(`${apiUrl}/api/entries`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(CurrentAppData.entries.map(e => ({
                        id: e.id,
                        appId: AppSystem.currentAppId,
                        content: e.content,
                        category: e.category || '',
                        tags: e.tags || [],
                        date: e.date,
                        dateISO: e.dateISO,
                        timestamp: e.timestamp
                    })))
                });

                // å†ä¸‹è½½äº‘ç«¯æ‰€æœ‰æ•°æ®
                const response = await fetch(`${apiUrl}/api/entries?appId=${AppSystem.currentAppId}`);
                if (!response.ok) throw new Error('ä¸‹è½½å¤±è´¥');
                
                const cloudEntries = await response.json();
                const convertedEntries = cloudEntries.map(e => ({
                    id: e.uuid || e.id,
                    date: e.date,
                    dateISO: e.date_iso || e.dateISO,
                    category: e.category,
                    content: e.content,
                    tags: typeof e.tags === 'string' ? JSON.parse(e.tags) : (e.tags || []),
                    timestamp: e.timestamp
                }));

                // åˆå¹¶ï¼ˆæŒ‰æ—¶é—´æˆ³ä¿ç•™æœ€æ–°ç‰ˆæœ¬ï¼‰
                const mergedMap = new Map();
                
                // å…ˆæ·»åŠ æœ¬åœ°æ‰€æœ‰æ¡ç›®
                CurrentAppData.entries.forEach(e => mergedMap.set(e.id, e));
                
                // å†æ·»åŠ äº‘ç«¯æ¡ç›®ï¼ˆå¦‚æœæœ‰å†²çªï¼Œä¿ç•™æ—¶é—´æˆ³æ›´æ–°çš„ï¼‰
                convertedEntries.forEach(e => {
                    const existing = mergedMap.get(e.id);
                    if (!existing || e.timestamp > existing.timestamp) {
                        mergedMap.set(e.id, e);
                    }
                });

                CurrentAppData.entries = Array.from(mergedMap.values());
                CurrentAppData.entries.sort((a, b) => b.timestamp - a.timestamp);
                
                saveAppData();
                renderAllEntries();
                renderStats();
                showNotification(`åŒæ­¥å®Œæˆï¼Œå…± ${CurrentAppData.entries.length} æ¡è®°å½•`);
                
            } catch (err) {
                console.error('åŒæ­¥å¤±è´¥:', err);
                showNotification('äº‘ç«¯è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åœ°å€å’Œç½‘ç»œ');
            }
        }

        // ==================== ä¿å­˜è®°å½•ï¼ˆä¿®å¤ç©ºæ ¼é—®é¢˜ï¼‰====================

        // ä¿å­˜è®°å½•ï¼ˆç”µè„‘ç«¯ï¼‰- ä¿®å¤ç©ºæ ¼é—®é¢˜
        function saveEntry() {
            const content = document.getElementById('content').value;
            // åªæ£€æŸ¥æ˜¯å¦ä¸ºç©ºï¼ˆå»é™¤äº†é¦–å°¾ç©ºæ ¼ï¼Œä½†ä¿å­˜æ—¶ä¿ç•™åŸå§‹å†…å®¹ï¼‰
            if (!content.trim()) {
                showNotification('è¯·è¾“å…¥å†…å®¹');
                return;
            }

            const tagsInput = document.getElementById('tags').value;
            const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(t => t) : [];
            
            const activeCategoryBtn = document.querySelector('.category-btn.active');
            const category = activeCategoryBtn ? activeCategoryBtn.dataset.category : CurrentAppData.categories[0];

            const entry = {
                id: Date.now(),
                date: new Date().toLocaleString('zh-CN'),
                dateISO: new Date().toISOString(),
                category,
                content: content, // ä¿å­˜åŸå§‹å†…å®¹ï¼Œä¿ç•™æ‰€æœ‰ç©ºæ ¼å’Œæ ¼å¼
                tags,
                timestamp: new Date().getTime()
            };

            // é™åˆ¶å†…å®¹é•¿åº¦
            if (content.length > 10000) {
                if (!confirm('å†…å®¹è¾ƒé•¿ï¼ˆè¶…è¿‡10000å­—ç¬¦ï¼‰ï¼Œç¡®å®šè¦ä¿å­˜å—ï¼Ÿ')) {
                    return;
                }
            }

            CurrentAppData.entries.unshift(entry);
            
            // ä¿å­˜åˆ°å½“å‰åº”ç”¨
            const success = saveAppData();
            
            if (success) {
                renderStats();
                renderAllEntries();
                clearForm();
                updateRecordCount();
                checkStorageStatus();
                showNotification('è®°å½•ä¿å­˜æˆåŠŸï¼');
            } else {
                showNotification('ä¿å­˜å¤±è´¥ï¼Œå­˜å‚¨ç©ºé—´å¯èƒ½ä¸è¶³');
            }
        }

        // ä¿å­˜è®°å½•ï¼ˆç§»åŠ¨ç«¯ï¼‰- ä¿®å¤ç©ºæ ¼é—®é¢˜
        function saveMobileEntry() {
            const content = document.getElementById('mobileContent').value;
            // åªæ£€æŸ¥æ˜¯å¦ä¸ºç©ºï¼ˆå»é™¤äº†é¦–å°¾ç©ºæ ¼ï¼Œä½†ä¿å­˜æ—¶ä¿ç•™åŸå§‹å†…å®¹ï¼‰
            if (!content.trim()) {
                showNotification('è¯·è¾“å…¥å†…å®¹');
                return;
            }

            const tagsInput = document.getElementById('mobileTags').value;
            const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(t => t) : [];
            
            const activeCategoryBtn = document.querySelector('#mobileCategoryContainer .category-btn.active');
            const category = activeCategoryBtn ? activeCategoryBtn.dataset.category : CurrentAppData.categories[0];

            const entry = {
                id: Date.now(),
                date: new Date().toLocaleString('zh-CN'),
                dateISO: new Date().toISOString(),
                category,
                content: content, // ä¿å­˜åŸå§‹å†…å®¹ï¼Œä¿ç•™æ‰€æœ‰ç©ºæ ¼å’Œæ ¼å¼
                tags,
                timestamp: new Date().getTime()
            };

            CurrentAppData.entries.unshift(entry);
            
            const success = saveAppData();
            
            if (success) {
                renderStats();
                renderAllEntries();
                clearMobileForm();
                showMobilePanel('none');
                updateRecordCount();
                checkStorageStatus();
                showNotification('è®°å½•ä¿å­˜æˆåŠŸï¼');
            } else {
                showNotification('ä¿å­˜å¤±è´¥');
            }
        }

        // æ¸…ç©ºè¡¨å•
        function clearForm() {
            document.getElementById('content').value = '';
            document.getElementById('tags').value = '';
        }

        function clearMobileForm() {
            document.getElementById('mobileContent').value = '';
            document.getElementById('mobileTags').value = '';
            
            // é‡ç½®åˆ†ç±»æŒ‰é’®åˆ°ç¬¬ä¸€ä¸ª
            const categoryBtns = document.querySelectorAll('#mobileCategoryContainer .category-btn');
            categoryBtns.forEach((btn, index) => {
                if (index === 0) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // ==================== åŸæœ‰å…¶ä»–åŠŸèƒ½ä¿æŒä¸å˜ ====================
        
        // æ˜¾ç¤ºæ‰€æœ‰è®°å½•
        function renderAllEntries() {
            const displayArea = document.getElementById('displayArea');
            const pagination = document.getElementById('pagination');
            
            if (!displayArea) return;
            
            if (CurrentAppData.entries.length === 0) {
                displayArea.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #777;">
                        <div style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;">ğŸ“­</div>
                        <h3>æš‚æ— è®°å½•</h3>
                        <p>å¼€å§‹å†™ä¸‹ä½ çš„ç¬¬ä¸€æ¡è®°å½•å§ï¼</p>
                    </div>
                `;
                if (pagination) pagination.style.display = 'none';
                return;
            }
            
            // è®¡ç®—åˆ†é¡µ
            const totalEntries = CurrentAppData.entries.length;
            CurrentAppData.totalPages = Math.ceil(totalEntries / CurrentAppData.pageSize);
            
            if (CurrentAppData.currentPage > CurrentAppData.totalPages) {
                CurrentAppData.currentPage = 1;
            }
            
            const startIndex = (CurrentAppData.currentPage - 1) * CurrentAppData.pageSize;
            const endIndex = Math.min(startIndex + CurrentAppData.pageSize, totalEntries);
            const currentEntries = CurrentAppData.entries.slice(startIndex, endIndex);
            
            // æŒ‰æ—¥æœŸåˆ†ç»„
            const groupedEntries = {};
            currentEntries.forEach(entry => {
                const dateKey = new Date(entry.timestamp).toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                if (!groupedEntries[dateKey]) {
                    groupedEntries[dateKey] = [];
                }
                groupedEntries[dateKey].push(entry);
            });
            
            // æŒ‰æ—¥æœŸæ’åº
            const sortedDates = Object.keys(groupedEntries).sort((a, b) => {
                return new Date(b) - new Date(a);
            });
            
            let html = '';
            
            sortedDates.forEach(date => {
                html += `<h3>ğŸ“… ${date}</h3>`;
                
                groupedEntries[date].forEach(entry => {
                    const timeStr = new Date(entry.timestamp).toLocaleTimeString('zh-CN', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    // ç”Ÿæˆæ ‡ç­¾HTML
                    let tagsHtml = '';
                    if (entry.tags && entry.tags.length > 0) {
                        tagsHtml = `<div class="entry-tags">`;
                        entry.tags.forEach(tag => {
                            const colorClass = tagColors[tag] ? `tag-${tag}` : 'tag-default';
                            tagsHtml += `<span class="tag ${colorClass}">${tag}</span>`;
                        });
                        tagsHtml += `</div>`;
                    }
                    
                    html += `
                        <div class="entry-item">
                            <div class="entry-header">
                                <span class="entry-date">${timeStr}</span>
                                <span class="entry-category">${entry.category}</span>
                            </div>
                            <div class="entry-content">${entry.content.replace(/\n/g, '<br>')}</div>
                            ${tagsHtml}
                        </div>
                    `;
                });
            });
            
            displayArea.innerHTML = html;
            
            // æ›´æ–°åˆ†é¡µæ§ä»¶
            updatePagination();
        }

        // æ›´æ–°åˆ†é¡µæ§ä»¶
        function updatePagination() {
            const pagination = document.getElementById('pagination');
            const pageInfo = document.getElementById('pageInfo');
            const prevBtn = document.getElementById('prevPage');
            const nextBtn = document.getElementById('nextPage');
            
            if (!pagination) return;
            
            if (CurrentAppData.totalPages > 1) {
                pagination.style.display = 'flex';
                if (pageInfo) pageInfo.textContent = `ç¬¬${CurrentAppData.currentPage}é¡µ/å…±${CurrentAppData.totalPages}é¡µ`;
                if (prevBtn) prevBtn.disabled = CurrentAppData.currentPage === 1;
                if (nextBtn) nextBtn.disabled = CurrentAppData.currentPage === CurrentAppData.totalPages;
            } else {
                pagination.style.display = 'none';
            }
        }

        // æ”¹å˜é¡µç 
        function changePage(delta) {
            const newPage = CurrentAppData.currentPage + delta;
            if (newPage >= 1 && newPage <= CurrentAppData.totalPages) {
                CurrentAppData.currentPage = newPage;
                renderAllEntries();
            }
        }

        // æ”¹å˜æ¯é¡µæ˜¾ç¤ºæ•°é‡
        function changePageSize() {
            const pageSize = document.getElementById('pageSize');
            if (!pageSize) return;
            
            const newSize = parseInt(pageSize.value);
            if (newSize !== CurrentAppData.pageSize) {
                CurrentAppData.pageSize = newSize;
                CurrentAppData.currentPage = 1;
                renderAllEntries();
            }
        }

        // é˜²æŠ–ç­›é€‰
        function debouncedFilter() {
            clearTimeout(CurrentAppData.debounceTimer);
            CurrentAppData.debounceTimer = setTimeout(() => {
                filterEntries();
            }, 300);
        }

        // ç­›é€‰è®°å½•
        function filterEntries() {
            const searchInput = document.getElementById('searchInput');
            const filterCategory = document.getElementById('filterCategory');
            const dateRange = document.getElementById('dateRange');
            
            if (!searchInput || !filterCategory || !dateRange) return;
            
            const searchText = searchInput.value.toLowerCase();
            const category = filterCategory.value;
            const range = dateRange.value;
            
            let filteredEntries = CurrentAppData.entries;
            
            // æŒ‰åˆ†ç±»ç­›é€‰
            if (category !== 'all') {
                filteredEntries = filteredEntries.filter(entry => entry.category === category);
            }
            
            // æŒ‰æ—¥æœŸèŒƒå›´ç­›é€‰
            if (range !== 'all') {
                const now = new Date();
                let startDate;
                
                switch(range) {
                    case 'today':
                        startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                        break;
                    case 'week':
                        startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 7);
                        break;
                    case 'month':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        break;
                    case 'year':
                        startDate = new Date(now.getFullYear(), 0, 1);
                        break;
                }
                
                if (startDate) {
                    filteredEntries = filteredEntries.filter(entry => 
                        new Date(entry.timestamp) >= startDate
                    );
                }
            }
            
            // æŒ‰æœç´¢è¯ç­›é€‰
            if (searchText) {
                filteredEntries = filteredEntries.filter(entry => 
                    entry.content.toLowerCase().includes(searchText) ||
                    (entry.tags && entry.tags.some(tag => tag.toLowerCase().includes(searchText)))
                );
            }
            
            // æ˜¾ç¤ºç­›é€‰ç»“æœ
            displayFilteredEntries(filteredEntries);
        }

        // æ˜¾ç¤ºç­›é€‰åçš„è®°å½•
        function displayFilteredEntries(entries) {
            const displayArea = document.getElementById('displayArea');
            const pagination = document.getElementById('pagination');
            
            if (!displayArea) return;
            
            if (entries.length === 0) {
                displayArea.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #777;">
                        <div style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;">ğŸ”</div>
                        <h3>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è®°å½•</h3>
                        <p>å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶</p>
                    </div>
                `;
                if (pagination) pagination.style.display = 'none';
                return;
            }
            
            let html = '';
            
            // æŒ‰æ—¥æœŸåˆ†ç»„
            const groupedEntries = {};
            entries.forEach(entry => {
                const dateKey = new Date(entry.timestamp).toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                if (!groupedEntries[dateKey]) {
                    groupedEntries[dateKey] = [];
                }
                groupedEntries[dateKey].push(entry);
            });
            
            // æŒ‰æ—¥æœŸæ’åº
            const sortedDates = Object.keys(groupedEntries).sort((a, b) => {
                return new Date(b) - new Date(a);
            });
            
            sortedDates.forEach(date => {
                html += `<h3>ğŸ“… ${date}</h3>`;
                
                groupedEntries[date].forEach(entry => {
                    const timeStr = new Date(entry.timestamp).toLocaleTimeString('zh-CN', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    // ç”Ÿæˆæ ‡ç­¾HTML
                    let tagsHtml = '';
                    if (entry.tags && entry.tags.length > 0) {
                        tagsHtml = `<div class="entry-tags">`;
                        entry.tags.forEach(tag => {
                            const colorClass = tagColors[tag] ? `tag-${tag}` : 'tag-default';
                            tagsHtml += `<span class="tag ${colorClass}">${tag}</span>`;
                        });
                        tagsHtml += `</div>`;
                    }
                    
                    html += `
                        <div class="entry-item">
                            <div class="entry-header">
                                <span class="entry-date">${timeStr}</span>
                                <span class="entry-category">${entry.category}</span>
                            </div>
                            <div class="entry-content">${entry.content.replace(/\n/g, '<br>')}</div>
                            ${tagsHtml}
                        </div>
                    `;
                });
            });
            
            displayArea.innerHTML = html;
            if (pagination) pagination.style.display = 'none';
        }

        // æ¸²æŸ“ç»Ÿè®¡
        function renderStats() {
            const today = new Date().toDateString();
            const todayEntries = CurrentAppData.entries.filter(entry => 
                new Date(entry.timestamp).toDateString() === today
            );
            
            const stats = {
                'ä»Šæ—¥': todayEntries.length,
                'æ€»è®¡': CurrentAppData.entries.length,
                'åˆ†ç±»': new Set(CurrentAppData.entries.map(e => e.category)).size,
                'æ ‡ç­¾': new Set(CurrentAppData.entries.flatMap(e => e.tags || [])).size
            };
            
            // æ›´æ–°ç”µè„‘ç«¯ç»Ÿè®¡
            const statsDiv = document.getElementById('stats');
            if (statsDiv) {
                statsDiv.innerHTML = Object.entries(stats).map(([label, value]) => `
                    <div class="stat-item">
                        <div class="stat-value">${value}</div>
                        <div class="stat-label">${label}</div>
                    </div>
                `).join('');
            }
            
            // æ›´æ–°ç§»åŠ¨ç«¯ç»Ÿè®¡
            const mobileStatsDiv = document.getElementById('mobileStats');
            if (mobileStatsDiv) {
                mobileStatsDiv.innerHTML = Object.entries(stats).map(([label, value]) => `
                    <div class="stat-item">
                        <div class="stat-value">${value}</div>
                        <div class="stat-label">${label}</div>
                    </div>
                `).join('');
            }
        }

        // æ›´æ–°è®°å½•è®¡æ•°
        function updateRecordCount() {
            const countElement = document.getElementById('recordCount');
            if (countElement) {
                countElement.textContent = `(${CurrentAppData.entries.length}æ¡)`;
            }
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬
        function setupEventListeners() {
            // ç”µè„‘ç«¯ç±»å‹æŒ‰é’®
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.category-btn').forEach(b => 
                        b.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    saveEntry();
                }
                if (e.key === 'Escape') {
                    clearForm();
                }
            });
        }

        // ç§»åŠ¨ç«¯é¢æ¿æ§åˆ¶
        function showMobilePanel(panel) {
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.mobile-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            if (panel === 'none') {
                document.querySelector('.mobile-tab:nth-child(1)').classList.add('active');
            } else if (panel === 'add') {
                document.querySelector('.mobile-tab:nth-child(2)').classList.add('active');
            } else if (panel === 'stats') {
                document.querySelector('.mobile-tab:nth-child(3)').classList.add('active');
            }
            
            // éšè—æ‰€æœ‰é¢æ¿
            document.querySelectorAll('.mobile-panel').forEach(p => {
                p.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„é¢æ¿
            if (panel !== 'none') {
                const activePanel = document.getElementById(`mobile${panel.charAt(0).toUpperCase() + panel.slice(1)}Panel`);
                if (activePanel) {
                    activePanel.classList.add('active');
                    
                    // é‡ç½®æ»šåŠ¨ä½ç½®åˆ°é¡¶éƒ¨
                    activePanel.scrollTop = 0;
                    
                    // å¦‚æœæ˜¾ç¤ºçš„æ˜¯æ–°å¢é¢æ¿ï¼Œèšç„¦è¾“å…¥æ¡†ï¼ˆå»¶è¿Ÿä¸€ç‚¹ç¡®ä¿é¢æ¿æ˜¾ç¤ºå®Œæˆï¼‰
                    if (panel === 'add') {
                        setTimeout(() => {
                            const textarea = document.getElementById('mobileContent');
                            if (textarea) {
                                textarea.focus();
                            }
                        }, 300);
                    }
                }
            }
        }

        function closeMobilePanel(panel) {
            const mobilePanel = document.getElementById(`mobile${panel.charAt(0).toUpperCase() + panel.slice(1)}Panel`);
            if (mobilePanel) {
                mobilePanel.classList.remove('active');
            }
            document.querySelector('.mobile-tab:nth-child(1)').classList.add('active');
        }

        // æ•°æ®å‹ç¼©åŠŸèƒ½
        function compressData(data) {
            try {
                // ç§»é™¤ä¸å¿…è¦çš„ç©ºæ ¼å’Œæ¢è¡Œ
                const compressed = data.map(entry => ({
                    i: entry.id,
                    d: entry.date,
                    di: entry.dateISO,
                    c: entry.category,
                    t: entry.tags,
                    ts: entry.timestamp,
                    ct: entry.content.replace(/\s+/g, ' ').trim()
                }));
                return JSON.stringify(compressed);
            } catch (error) {
                return JSON.stringify(data);
            }
        }

        function decompressData(compressed) {
            try {
                const parsed = JSON.parse(compressed);
                if (Array.isArray(parsed)) {
                    return parsed.map(item => ({
                        id: item.i || item.id,
                        date: item.d || item.date,
                        dateISO: item.di || item.dateISO,
                        category: item.c || item.category,
                        tags: item.t || item.tags,
                        timestamp: item.ts || item.timestamp,
                        content: item.ct || item.content
                    }));
                }
                return [];
            } catch (error) {
                try {
                    return JSON.parse(compressed);
                } catch (e) {
                    return [];
                }
            }
        }

        // å­˜å‚¨ç®¡ç†åŠŸèƒ½
        function checkStorageStatus() {
            const totalEntries = CurrentAppData.entries.length;
            const warningElement = document.getElementById('performanceWarning');
            
            if (!warningElement) return;
            
            if (totalEntries > 500) {
                warningElement.classList.remove('hidden');
            } else {
                warningElement.classList.add('hidden');
            }
        }

        function estimateStorageSize() {
            const entriesJson = JSON.stringify(CurrentAppData.entries);
            const sizeInBytes = new Blob([entriesJson]).size;
            
            if (sizeInBytes < 1024) {
                return sizeInBytes + ' B';
            } else if (sizeInBytes < 1024 * 1024) {
                return (sizeInBytes / 1024).toFixed(2) + ' KB';
            } else {
                return (sizeInBytes / (1024 * 1024)).toFixed(2) + ' MB';
            }
        }

        function openStorageModal() {
            const statsElement = document.getElementById('storageStats');
            if (statsElement) {
                const totalEntries = CurrentAppData.entries.length;
                const compressedSize = estimateStorageSize();
                statsElement.innerHTML = `
                    æ€»è®°å½•æ•°: ${totalEntries} æ¡<br>
                    ä¼°ç®—å­˜å‚¨: ${compressedSize}<br>
                    ${totalEntries > 1000 ? 'âš ï¸ å»ºè®®å¼€å¯å‹ç¼©æˆ–åˆ†æ‰¹å¯¼å‡º' : ''}
                `;
            }
            
            const compressContent = document.getElementById('compressContent');
            if (compressContent) {
                compressContent.checked = CurrentAppData.compressContent;
            }
            
            document.getElementById('storageModal').style.display = 'flex';
        }

        function optimizeStorage() {
            if (CurrentAppData.entries.length === 0) {
                showNotification('æ²¡æœ‰æ•°æ®å¯ä¼˜åŒ–');
                return;
            }
            
            const compressContent = document.getElementById('compressContent');
            if (compressContent) {
                CurrentAppData.compressContent = compressContent.checked;
            }
            
            const optimizeDates = document.getElementById('optimizeDates');
            if (optimizeDates && optimizeDates.checked) {
                CurrentAppData.entries.forEach(entry => {
                    if (!entry.dateISO && entry.timestamp) {
                        entry.dateISO = new Date(entry.timestamp).toISOString();
                    }
                });
            }
            
            const success = saveAppData();
            
            if (success) {
                const compressedSize = estimateStorageSize();
                showNotification(`ä¼˜åŒ–å®Œæˆï¼å½“å‰å­˜å‚¨å¤§å°ï¼š${compressedSize}`);
                checkStorageStatus();
                closeModal('storageModal');
            } else {
                showNotification('ä¼˜åŒ–å¤±è´¥');
            }
        }

        function clearOldData() {
            const sixMonthsAgo = new Date();
            sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
            
            const oldEntries = CurrentAppData.entries.filter(entry => 
                new Date(entry.timestamp) < sixMonthsAgo
            );
            
            if (oldEntries.length === 0) {
                showNotification('æ²¡æœ‰æ‰¾åˆ°6ä¸ªæœˆå‰çš„æ—§æ•°æ®');
                return;
            }
            
            if (confirm(`æ‰¾åˆ°${oldEntries.length}æ¡6ä¸ªæœˆå‰çš„è®°å½•ï¼Œç¡®å®šè¦åˆ é™¤å—ï¼Ÿ`)) {
                CurrentAppData.entries = CurrentAppData.entries.filter(entry => 
                    new Date(entry.timestamp) >= sixMonthsAgo
                );
                
                const success = saveAppData();
                if (success) {
                    renderAllEntries();
                    renderStats();
                    updateRecordCount();
                    showNotification(`å·²åˆ é™¤${oldEntries.length}æ¡æ—§è®°å½•`);
                    checkStorageStatus();
                    closeModal('storageModal');
                }
            }
        }

        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰åº”ç”¨çš„æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                CurrentAppData.entries = [];
                const success = saveAppData();
                if (success) {
                    renderAllEntries();
                    renderStats();
                    updateRecordCount();
                    checkStorageStatus();
                    showNotification('æ•°æ®å·²æ¸…ç©ºï¼');
                }
            }
        }

        function backupData() {
            const backup = {
                entries: CurrentAppData.entries,
                customPhrases: CurrentAppData.customPhrases,
                categories: CurrentAppData.categories,
                quickTags: CurrentAppData.quickTags,
                backupDate: new Date().toLocaleString(),
                appId: AppSystem.currentAppId,
                appName: AppSystem.currentAppConfig.name
            };
            
            localStorage.setItem('backup_' + AppSystem.currentAppId, JSON.stringify(backup));
            showNotification('æ•°æ®å·²å¤‡ä»½åˆ°æœ¬åœ°å­˜å‚¨');
        }

        // åŒæ­¥åŠŸèƒ½
        function openSyncModal() {
            generateQRCode();
            document.getElementById('syncModal').style.display = 'flex';
        }

        function generateQRCode() {
            const dataStr = JSON.stringify({
                entries: CurrentAppData.entries,
                customPhrases: CurrentAppData.customPhrases,
                categories: CurrentAppData.categories,
                quickTags: CurrentAppData.quickTags,
                appId: AppSystem.currentAppId,
                appName: AppSystem.currentAppConfig.name,
                exportDate: new Date().toLocaleString(),
                count: CurrentAppData.entries.length
            }, null, 2);
            
            const canvas = document.getElementById('qrCanvas');
            if (!canvas) return;
            
            const container = canvas.parentElement;
            const size = Math.min(300, container.clientWidth - 40);
            
            canvas.width = size;
            canvas.height = size;
            
            if (typeof QRCode !== 'undefined') {
                QRCode.toCanvas(canvas, dataStr, {
                    width: size,
                    margin: 1,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                }, function(error) {
                    if (error) {
                        console.error('äºŒç»´ç ç”Ÿæˆå¤±è´¥:', error);
                        canvas.parentElement.innerHTML = `
                            <div style="color: #666; padding: 20px;">
                                <p>äºŒç»´ç ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç›´æ¥å¤åˆ¶æ•°æ®ï¼š</p>
                                <textarea style="width: 100%; height: 100px; margin-top: 10px; padding: 10px; font-family: monospace; font-size: 12px;">${dataStr}</textarea>
                            </div>
                        `;
                    }
                });
            } else {
                canvas.parentElement.innerHTML = `
                    <div style="color: #666; padding: 20px;">
                        <p>QRCodeåº“åŠ è½½ä¸­ï¼Œè¯·ç›´æ¥å¤åˆ¶æ•°æ®ï¼š</p>
                        <textarea style="width: 100%; height: 100px; margin-top: 10px; padding: 10px; font-family: monospace; font-size: 12px;">${dataStr}</textarea>
                    </div>
                `;
            }
        }

        function importData() {
            const importText = document.getElementById('importData').value.trim();
            
            if (!importText) {
                showNotification('è¯·è¾“å…¥è¦å¯¼å…¥çš„æ•°æ®');
                return;
            }
            
            try {
                const importedData = JSON.parse(importText);
                
                if (importedData.entries && Array.isArray(importedData.entries)) {
                    const existingIds = new Set(CurrentAppData.entries.map(e => e.id));
                    let addedCount = 0;
                    
                    importedData.entries.forEach(entry => {
                        if (!existingIds.has(entry.id)) {
                            CurrentAppData.entries.push(entry);
                            existingIds.add(entry.id);
                            addedCount++;
                        }
                    });
                    
                    CurrentAppData.entries.sort((a, b) => b.timestamp - a.timestamp);
                    
                    saveAppData();
                    
                    renderAllEntries();
                    renderStats();
                    updateRecordCount();
                    checkStorageStatus();
                    
                    showNotification(`æˆåŠŸå¯¼å…¥ ${addedCount} æ¡è®°å½•`);
                    closeModal('syncModal');
                } else {
                    throw new Error('æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                }
                
            } catch (error) {
                showNotification('å¯¼å…¥å¤±è´¥ï¼šæ•°æ®æ ¼å¼é”™è¯¯');
            }
        }

        function exportJSON() {
            const data = {
                entries: CurrentAppData.entries,
                customPhrases: CurrentAppData.customPhrases,
                categories: CurrentAppData.categories,
                quickTags: CurrentAppData.quickTags,
                appId: AppSystem.currentAppId,
                appName: AppSystem.currentAppConfig.name,
                exportDate: new Date().toLocaleString(),
                count: CurrentAppData.entries.length
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            
            if (typeof saveAs !== 'undefined') {
                saveAs(blob, `${AppSystem.currentAppConfig.name}_${new Date().toISOString().split('T')[0]}.json`);
            } else {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${AppSystem.currentAppConfig.name}_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
            
            showNotification('JSONæ•°æ®å¯¼å‡ºæˆåŠŸï¼');
            closeModal('syncModal');
        }

        // å¯¼å‡ºåŠŸèƒ½
        function openExportModal() {
            document.getElementById('exportModal').style.display = 'flex';
        }

        function getExportEntries() {
            const range = document.getElementById('exportRange').value;
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('filterCategory').value;
            
            let entries = CurrentAppData.entries;
            
            if (category !== 'all') {
                entries = entries.filter(entry => entry.category === category);
            }
            
            if (searchText && range === 'search') {
                entries = entries.filter(entry => 
                    entry.content.toLowerCase().includes(searchText) ||
                    (entry.tags && entry.tags.some(tag => tag.toLowerCase().includes(searchText)))
                );
            }
            
            if (range !== 'all' && range !== 'search') {
                const now = new Date();
                let startDate;
                
                switch(range) {
                    case 'today':
                        startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                        break;
                    case 'week':
                        const weekStart = new Date(now.getFullYear(), now.getMonth(), now.getDate() - now.getDay() + 1);
                        startDate = weekStart;
                        break;
                    case 'month':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        break;
                }
                
                if (startDate) {
                    entries = entries.filter(entry => 
                        new Date(entry.timestamp) >= startDate
                    );
                }
            }
            
            return entries;
        }

        function exportToPDF() {
            const entries = getExportEntries();
            
            if (entries.length === 0) {
                showNotification('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º');
                return;
            }
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFont("helvetica");
                
                const title = `${AppSystem.currentAppConfig.name} - ${new Date().toLocaleDateString('zh-CN')}`;
                doc.setFontSize(16);
                doc.setTextColor(52, 152, 219);
                doc.text(title, 105, 20, { align: 'center' });
                
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`å…± ${entries.length} æ¡è®°å½• | ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}`, 105, 28, { align: 'center' });
                
                let yPos = 40;
                
                const groupedEntries = {};
                entries.forEach(entry => {
                    const dateKey = new Date(entry.timestamp).toLocaleDateString('zh-CN');
                    if (!groupedEntries[dateKey]) {
                        groupedEntries[dateKey] = [];
                    }
                    groupedEntries[dateKey].push(entry);
                });
                
                const sortedDates = Object.keys(groupedEntries).sort((a, b) => new Date(b) - new Date(a));
                
                sortedDates.forEach(date => {
                    if (yPos > 270) {
                        doc.addPage();
                        yPos = 20;
                    }
                    
                    doc.setFontSize(12);
                    doc.setTextColor(41, 128, 185);
                    doc.text(`ğŸ“… ${date}`, 14, yPos);
                    yPos += 8;
                    
                    groupedEntries[date].forEach(entry => {
                        if (yPos > 270) {
                            doc.addPage();
                            yPos = 20;
                        }
                        
                        const timeStr = new Date(entry.timestamp).toLocaleTimeString('zh-CN', {
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        
                        doc.setFontSize(9);
                        doc.setTextColor(100, 100, 100);
                        doc.text(`${timeStr} [${entry.category}]`, 14, yPos);
                        yPos += 6;
                        
                        doc.setFontSize(10);
                        doc.setTextColor(0, 0, 0);
                        const lines = doc.splitTextToSize(entry.content, 180);
                        lines.forEach(line => {
                            if (yPos > 270) {
                                doc.addPage();
                                yPos = 20;
                            }
                            doc.text(line, 20, yPos);
                            yPos += 6;
                        });
                        
                        if (entry.tags && entry.tags.length > 0) {
                            if (yPos > 270) {
                                doc.addPage();
                                yPos = 20;
                            }
                            
                            let tagText = "ğŸ·ï¸ ";
                            entry.tags.forEach((tag, index) => {
                                tagText += tag;
                                if (index < entry.tags.length - 1) tagText += " â€¢ ";
                            });
                            
                            doc.setFontSize(8);
                            doc.setTextColor(100, 100, 100);
                            doc.text(tagText, 20, yPos);
                            yPos += 6;
                        }
                        
                        yPos += 4;
                    });
                    
                    yPos += 8;
                });
                
                doc.save(`${AppSystem.currentAppConfig.name}_${new Date().toISOString().split('T')[0]}.pdf`);
                showNotification('PDFå¯¼å‡ºæˆåŠŸï¼');
                closeModal('exportModal');
                
            } catch (error) {
                console.error('PDFå¯¼å‡ºå¤±è´¥:', error);
                showNotification('PDFå¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        function exportToWord() {
            const entries = getExportEntries();
            
            if (entries.length === 0) {
                showNotification('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º');
                return;
            }
            
            try {
                const doc = new docx.Document({
                    sections: [{
                        properties: {},
                        children: []
                    }]
                });
                
                const title = new docx.Paragraph({
                    text: `${AppSystem.currentAppConfig.name} - ${new Date().toLocaleDateString('zh-CN')}`,
                    heading: docx.HeadingLevel.TITLE,
                    alignment: docx.AlignmentType.CENTER,
                    spacing: { after: 200 }
                });
                
                const meta = new docx.Paragraph({
                    text: `å…± ${entries.length} æ¡è®°å½• | ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}`,
                    alignment: docx.AlignmentType.CENTER,
                    spacing: { after: 400 }
                });
                
                doc.addSection({
                    children: [title, meta]
                });
                
                const groupedEntries = {};
                entries.forEach(entry => {
                    const dateKey = new Date(entry.timestamp).toLocaleDateString('zh-CN');
                    if (!groupedEntries[dateKey]) {
                        groupedEntries[dateKey] = [];
                    }
                    groupedEntries[dateKey].push(entry);
                });
                
                const sortedDates = Object.keys(groupedEntries).sort((a, b) => new Date(b) - new Date(a));
                
                sortedDates.forEach(date => {
                    const dateTitle = new docx.Paragraph({
                        text: `ğŸ“… ${date}`,
                        heading: docx.HeadingLevel.HEADING_2,
                        spacing: { before: 400, after: 200 }
                    });
                    
                    doc.addSection({
                        children: [dateTitle]
                    });
                    
                    groupedEntries[date].forEach(entry => {
                        const timeStr = new Date(entry.timestamp).toLocaleTimeString('zh-CN', {
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        
                        const header = new docx.Paragraph({
                            children: [
                                new docx.TextRun({
                                    text: `${timeStr} `,
                                    bold: true,
                                    size: 20
                                }),
                                new docx.TextRun({
                                    text: `[${entry.category}]`,
                                    color: "2E86C1",
                                    bold: true,
                                    size: 20
                                })
                            ],
                            spacing: { after: 100 }
                        });
                        
                        const content = new docx.Paragraph({
                            text: entry.content,
                            spacing: { after: 100 }
                        });
                        
                        let tagParagraph;
                        if (entry.tags && entry.tags.length > 0) {
                            const tagRuns = [new docx.TextRun({
                                text: "ğŸ·ï¸ ",
                                size: 18
                            })];
                            
                            entry.tags.forEach((tag, index) => {
                                tagRuns.push(new docx.TextRun({
                                    text: tag,
                                    color: tagColors[tag] ? tagColors[tag].substring(1) : "7F8C8D",
                                    bold: true,
                                    size: 18
                                }));
                                if (index < entry.tags.length - 1) {
                                    tagRuns.push(new docx.TextRun({
                                        text: " â€¢ ",
                                        size: 18
                                    }));
                                }
                            });
                            
                            tagParagraph = new docx.Paragraph({
                                children: tagRuns,
                                spacing: { after: 200 }
                            });
                        }
                        
                        const children = [header, content];
                        if (tagParagraph) children.push(tagParagraph);
                        
                        doc.addSection({
                            children: children
                        });
                    });
                });
                
                docx.Packer.toBlob(doc).then(blob => {
                    if (typeof saveAs !== 'undefined') {
                        saveAs(blob, `${AppSystem.currentAppConfig.name}_${new Date().toISOString().split('T')[0]}.docx`);
                    } else {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `${AppSystem.currentAppConfig.name}_${new Date().toISOString().split('T')[0]}.docx`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    }
                    showNotification('Wordæ–‡æ¡£å¯¼å‡ºæˆåŠŸï¼');
                    closeModal('exportModal');
                });
                
            } catch (error) {
                console.error('Wordå¯¼å‡ºå¤±è´¥:', error);
                showNotification('Wordå¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        function exportToText() {
            const entries = getExportEntries();
            
            if (entries.length === 0) {
                showNotification('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º');
                return;
            }
            
            let textContent = `${AppSystem.currentAppConfig.name}\n`;
            textContent += `ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}\n`;
            textContent += `å…± ${entries.length} æ¡è®°å½•\n`;
            textContent += '='.repeat(50) + '\n\n';
            
            const groupedEntries = {};
            entries.forEach(entry => {
                const dateKey = new Date(entry.timestamp).toLocaleDateString('zh-CN');
                if (!groupedEntries[dateKey]) {
                    groupedEntries[dateKey] = [];
                }
                groupedEntries[dateKey].push(entry);
            });
            
            const sortedDates = Object.keys(groupedEntries).sort((a, b) => new Date(b) - new Date(a));
            
            sortedDates.forEach(date => {
                textContent += `ğŸ“… ${date}\n`;
                textContent += '-'.repeat(30) + '\n';
                
                groupedEntries[date].forEach(entry => {
                    const timeStr = new Date(entry.timestamp).toLocaleTimeString('zh-CN', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    textContent += `${timeStr} [${entry.category}]\n`;
                    textContent += entry.content + '\n';
                    
                    if (entry.tags && entry.tags.length > 0) {
                        textContent += 'ğŸ·ï¸ ' + entry.tags.join(' â€¢ ') + '\n';
                    }
                    
                    textContent += '\n';
                });
                
                textContent += '\n';
            });
            
            const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8' });
            
            if (typeof saveAs !== 'undefined') {
                saveAs(blob, `${AppSystem.currentAppConfig.name}_${new Date().toISOString().split('T')[0]}.txt`);
            } else {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${AppSystem.currentAppConfig.name}_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
            
            showNotification('çº¯æ–‡æœ¬å¯¼å‡ºæˆåŠŸï¼');
            closeModal('exportModal');
        }

        // å¸¸ç”¨çŸ­è¯­ç®¡ç†
        function managePhrases() {
            const phraseList = document.getElementById('phraseList');
            if (!phraseList) return;
            
            phraseList.innerHTML = '';
            
            CurrentAppData.customPhrases.forEach((phrase, index) => {
                const phraseItem = document.createElement('div');
                phraseItem.className = 'phrase-item';
                phraseItem.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 8px; background: white; margin-bottom: 5px; border-radius: 4px;';
                phraseItem.innerHTML = `
                    <span>${phrase}</span>
                    <button onclick="removePhrase(${index})" style="padding: 2px 8px; font-size: 12px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer;">åˆ é™¤</button>
                `;
                phraseList.appendChild(phraseItem);
            });
            
            document.getElementById('phraseModal').style.display = 'flex';
        }

        function addCustomPhrase() {
            const newPhraseInput = document.getElementById('newPhrase');
            if (!newPhraseInput) return;
            
            const phrase = newPhraseInput.value.trim();
            
            if (!phrase) {
                showNotification('è¯·è¾“å…¥çŸ­è¯­å†…å®¹');
                return;
            }
            
            if (!CurrentAppData.customPhrases.includes(phrase)) {
                CurrentAppData.customPhrases.push(phrase);
                saveAppData();
                renderQuickSelect();
                renderMobileQuickSelect();
                managePhrases();
                newPhraseInput.value = '';
                showNotification('çŸ­è¯­æ·»åŠ æˆåŠŸ');
            } else {
                showNotification('è¯¥çŸ­è¯­å·²å­˜åœ¨');
            }
        }

        function removePhrase(index) {
            CurrentAppData.customPhrases.splice(index, 1);
            saveAppData();
            renderQuickSelect();
            renderMobileQuickSelect();
            managePhrases();
            showNotification('çŸ­è¯­å·²åˆ é™¤');
        }

        // å·¥å…·å‡½æ•°
        function showNotification(message) {
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initAppSystem);
    </script>

    <!-- å¼•å…¥å¤–éƒ¨åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docx@7.8.0/build/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
</body>
</html>